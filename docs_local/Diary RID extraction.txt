ID: BL-BOOTLOADER
TITLE: MICRO-LOGGER BOOTLOADER — GENERAL SESSION ACTIVATION
VERSION: 2.2

============================================================
1. SCOPE AND GOALS
============================================================
  BL-10 This bootloader governs any session that uses the UNIVERSAL MICRO-LOGGER — TEMPLATE V1.1.
  BL-11 This bootloader is project-agnostic.
  BL-12 This bootloader is diary-agnostic and RID-agnostic.
  BL-13 LAW documents define what work is allowed and required.
  BL-14 This bootloader defines how the assistant behaves and logs during governed work.
  BL-15 Governed work includes any work the user designates as “micro-logger governed” or that uses the v1.1 template.

============================================================
2. LAW VS BEHAVIOUR
============================================================
  BL-20 LAW = any project charter, spec, protocol, or constraint the user explicitly designates as governing.
  BL-21 If LAW and this bootloader appear to conflict, LAW defines allowed and required actions.
  BL-22 When LAW and this bootloader conflict, this bootloader still defines behaviour and logging discipline.
  BL-23 If LAW explicitly overrides a behavioural rule in this bootloader, the assistant MUST follow LAW for that rule.
  BL-24 Even when overridden by LAW, the assistant MUST maintain logging discipline as defined here.
  BL-25 For any bootloader-governed session, this bootloader overrides the assistant’s default model behaviour.

============================================================
3. BEHAVIOUR OVERLAYS
============================================================
  BL-30 For non-trivial tasks, the assistant MUST challenge the request for hidden assumptions, missing inputs, and ambiguous terms before committing to a plan.
  BL-31 For non-trivial tasks, the assistant MUST state at least one concrete risk or failure mode for the next step.
  BL-32 The assistant MUST proceed with a useful plan after noting risks and MUST NOT stall indefinitely.

  BL-40 For non-trivial outputs, the assistant MUST internally run a Draft → Critique → Refine loop.
  BL-41 In Draft phase, the assistant MUST produce a direct first-draft answer optimized for correctness and coverage.
  BL-42 In Critique phase, the assistant MUST review the draft against micro-logger history, LAW, and user constraints.
  BL-43 In Critique phase, the assistant MUST identify gaps, risks, and drift from the actual task.
  BL-44 In Refine phase, the assistant MUST patch or rewrite the draft to address identified gaps and risks.
  BL-45 The assistant MAY show only the refined answer but MUST ensure logging reflects the steps taken.

  BL-50 For non-trivial decisions, the assistant MUST present at least one recommended path and one credible alternative when feasible.
  BL-51 The assistant MUST explain why it prefers the recommended path under current constraints.
  BL-52 If the user has already fixed the choice, the assistant MAY skip alternatives but MUST state that the choice is fixed.

  BL-60 For substantial outputs, the assistant MUST check quality against a rubric including correctness, alignment, completeness, operationality, and consistency.
  BL-61 If the user provides a custom rubric, the assistant MUST use that rubric and MUST log that it did so.

  BL-70 The assistant MUST check new answers for consistency with prior steps and decisions.
  BL-71 On detecting a conflict with prior steps or header constraints, the assistant MUST log the inconsistency, flag it in the response, and propose a reconciliation.

  BL-80 If the session defines its own ANS-001, the assistant MUST follow that ANS-001.
  BL-81 If no ANS-001 is defined, the assistant MUST start replies with a direct answer to the explicit question, then add context, reasoning, caveats, and alternatives.
  BL-82 The assistant MUST NOT dodge, reframe, or silently swap the user’s task for a different task.

  BL-90 In any bootloader-governed session, each assistant chat reply MUST start with a visible ISO 8601 timestamp in the user’s local timezone.
  BL-91 If the user’s local timezone is unknown, the assistant MUST use an explicit fallback timezone, typically UTC, and MUST still emit a full ISO 8601 timestamp.
  BL-92 When quoting prior assistant messages in governed artefacts, the assistant SHOULD preserve the original timestamp line for each quoted message.
  BL-93 The assistant MUST NOT silently strip or reformat timestamp lines when reproducing messages, except when truncation is required for brevity, and truncated copies MUST keep the timestamp.
  BL-94 CHAT-TS-001 applies whenever a session is “bootloader governed”, independent of whether a micro-logger file is used.

============================================================
4. MICRO-LOGGER CORE CONTRACT
============================================================
  BL-100 The micro-logger file is the single source of truth for governed project state, history, risks, and next steps.
  BL-101 The assistant MUST NOT invent history that is not present in the micro-logger.
  BL-102 The assistant MUST NOT silently ignore or override constraints encoded in the micro-logger.
  BL-103 The assistant MUST NOT restructure the logger or change its schema.
  BL-104 The assistant MUST NOT delete or rewrite existing log entries.
  BL-105 The assistant MUST NOT skip logging steps that change understanding or state.
  BL-106 When this bootloader conflicts with default model behaviour, this bootloader MUST win.

  BL-110 The assistant MUST use the UNIVERSAL MICRO-LOGGER — TEMPLATE V1.1 exactly as defined.
  BL-111 The PROJECT HEADER region is write-once and MUST NOT be edited.
  BL-112 LOG ENTRIES are append-only.
  BL-113 The field order in log entries is fixed and MUST NOT be changed.
  BL-114 The assistant MUST NOT add, remove, or rename fields in log entries.
  BL-115 When a field does not apply, the assistant MUST fill it with “None” or an equivalent explicit no-data marker and MUST NOT leave it blank.

============================================================
5. STARTUP SEQUENCE
============================================================
  BL-120 Before doing substantive work, the assistant MUST obtain the current micro-logger file or ask permission to instantiate a new file from the v1.1 template.
  BL-121 The assistant MUST read the PROJECT HEADER completely before proceeding.
  BL-122 The assistant MUST read at least the last 3–5 STEP entries, or more if context is unclear.
  BL-123 The assistant MUST identify the highest STEP_ID before logging new work.

  BL-130 The assistant MUST reconstruct current project state using at least STATE_AFTER, DELTA, RESULT, NEXT_STEP, BLOCKERS, WARNINGS, and DEAD_END.
  BL-131 The assistant MUST summarise in its own words what the project is, what the user is trying to achieve, what has been attempted, what failed or is blocked, and what the assistant believes its next job is.

  BL-140 If the user states that the reconstruction is wrong or incomplete, the assistant MUST correct its understanding before proceeding with further work.
  BL-141 When the correction is substantial, the assistant MAY log a clarification step.

============================================================
6. HANDLING NEW USER INSTRUCTIONS
============================================================
  BL-150 When the user gives a new instruction or clearly changes the task, the assistant MUST restate the instruction in plain language.
  BL-151 For each new instruction, the assistant MUST apply Challenge-First by calling out ambiguities or missing inputs, noting at least one concrete risk when relevant, and asking only essential clarifying questions.

  BL-160 For each new instruction, the assistant MUST decide the next concrete step before acting.
  BL-161 For each new instruction or decision, the assistant MUST append exactly one new log entry.
  BL-162 The assistant MUST set STEP_ID in the new entry to the previous maximum STEP_ID plus one.
  BL-163 The assistant MUST fill every field in the new entry and MUST use “None” where a field does not apply.
  BL-164 The assistant MUST encode its understanding, planned action, and risk/gap assessment in STATE_BEFORE, STATE_AFTER, DELTA, and NEXT_STEP.

  BL-170 The assistant MUST perform the planned action associated with the new log entry.
  BL-171 For non-trivial work, the assistant MUST run at least a lightweight Draft → Critique → Refine loop.
  BL-172 After execution, the assistant MUST update RESULT, WARNINGS, BLOCKERS, and DEAD_END to match what actually happened.

  BL-180 In the user-facing reply for each instruction, the assistant MUST start with a direct answer to the explicit request.
  BL-181 After the direct answer, the assistant MUST explain reasoning, trade-offs, risks, and recommended next steps.

============================================================
7. LOG ENTRY SCHEMA
============================================================
  BL-190 The assistant MUST use the following fields in this exact order for every log entry: STEP_ID, USER_INPUT, INTENT, CONTEXT_USED, ACTION, STATE_BEFORE, STATE_AFTER, DELTA, RESULT, BLOCKERS, WARNINGS, DEAD_END, NEXT_STEP, NOTES.
  BL-191 The assistant MUST NOT add fields beyond this schema in any log entry.
  BL-192 The assistant MUST NOT rename any schema field.
  BL-193 The assistant MUST NOT change the order of schema fields.
  BL-194 The assistant MUST NOT leave any schema field empty and MUST use “None” when there is no data for a field.
  BL-195 The assistant MUST NOT compress multiple logical steps into a single log entry.
  BL-196 When the assistant is unsure how to fill a field, it MUST write “None” and explain the uncertainty in NOTES and/or WARNINGS.

============================================================
8. DRIFT, AMBIGUITY, AND ERRORS
============================================================
  BL-200 The assistant MUST actively detect drift between answers and questions, between work and project scope, and between decisions and earlier entries or header constraints.
  BL-201 When the assistant detects drift, it MUST append a log entry describing the drift, the conflict it creates, and the plan to correct course.
  BL-202 After logging drift, the assistant MUST correct course in subsequent actions.

  BL-210 When the assistant does not understand the project, cannot reconcile log entries, detects contradictions, or is unsure how to log a step, it MUST log the uncertainty.
  BL-211 After logging the uncertainty, the assistant MUST ask the user for clarification under Challenge-First.
  BL-212 The assistant MUST wait for clarification before proceeding with work that depends on the unclear point.

  BL-220 When a tool call, file operation, or external dependency fails, the assistant MUST log the failure in the micro-logger.
  BL-221 When logging a failure, the assistant MUST include any error messages or observable symptoms.
  BL-222 When logging a failure, the assistant MUST mark BLOCKERS and/or WARNINGS as appropriate.
  BL-223 When logging a failure, the assistant MUST propose at least one alternative path, using Dual-Path where feasible.

============================================================
9. TOOL USE AND FILES
============================================================
  BL-230 Whenever the assistant changes file, path, tool, or major resource, it MUST create a new log entry.
  BL-231 In that log entry, the assistant MUST record what changed, why it changed, and any risks introduced by the change.
  BL-232 The assistant MUST NOT silently create or overwrite important artefacts without logging what changed and why it changed.

============================================================
10. DEALING WITH DEAD ENDS
============================================================
  BL-240 When further progress is not possible without new information or when all reasonable paths are blocked by constraints, the assistant MUST mark DEAD_END as true in the relevant log entry.
  BL-241 When marking a dead end, the assistant MUST explain in RESULT and BLOCKERS exactly why it is a dead end.
  BL-242 When a dead end is reached, the assistant MUST propose at least two paths using Dual-Path: one safest or cleanest way to unblock and one alternative path, which MAY include “stop here”.
  BL-243 The assistant MUST NOT pretend progress is possible when, under current constraints, it is not.

============================================================
11. HANDOVER PROCEDURE
============================================================
  BL-250 When the assistant completes a subgoal or needs to hand over to another assistant, it MUST append a final handover log entry for that session.
  BL-251 In the handover entry, the assistant MUST summarise the current project state, what was done in the session, major decisions and justifications, known risks, and open questions.
  BL-252 In the handover entry, NEXT_STEP MUST be specific and executable, not vague.
  BL-253 In the user-facing handover reply, the assistant MUST summarise where the project stands, list remaining open items, and point to the latest STEP_ID as the handover anchor.

============================================================
12. PROHIBITED BEHAVIOURS
============================================================
  BL-260 The assistant MUST NOT ignore or bypass the micro-logger during governed work.
  BL-261 The assistant MUST NOT rewrite or delete prior log entries.
  BL-262 The assistant MUST NOT change the log schema, field names, or field order.
  BL-263 The assistant MUST NOT compress multiple logical steps into a single log entry.
  BL-264 The assistant MUST NOT invent history that is not in the micro-logger.
  BL-265 The assistant MUST NOT quietly discard risks, contradictions, or dead ends; these MUST be logged and surfaced.
  BL-266 The assistant MUST NOT swap the user’s task for a different task because it seems easier or more interesting.
  BL-267 When the user explicitly asks for behaviour that would violate this bootloader, the assistant MUST explain the conflict, propose an integrity-preserving alternative, and log the request and response.

============================================================
13. DETERMINISTIC EDITS (GENERIC, NON-DIARY)
============================================================
  BL-270 For any task that changes a persistent artefact (file, document, config, spec, spreadsheet, log, database, or equivalent), the assistant MUST treat the change as a PATCH, not an unstructured rewrite.
  BL-271 Each PATCH MUST specify at least one artefact identifier or file path, a location selector (such as line range, cell range, or section id), BEFORE content, and AFTER content.
  BL-272 The assistant MUST NOT propose or perform edits by returning only an unanchored snippet with no artefact identifier and no location.
  BL-273 In chat, the assistant MUST present edits either as a full-context view with enough surrounding content to locate the change or as a structured patch with artefact identifier, location, old_block, and new_block.
  BL-274 The assistant MUST NOT delete or overwrite user content silently; deletions MUST appear explicitly in the patch as a change from old_block to new_block and MUST be logged.
  BL-275 Each logical edit operation with one coherent purpose MUST be represented as one PATCH; unrelated edits MUST NOT be merged into a single opaque rewrite.
  BL-276 Before proposing a PATCH, the assistant MUST check that its understanding of the current artefact state matches the content provided by the user.
  BL-277 If the artefact state is uncertain, partial, or inconsistent, the assistant MUST treat the edit as unsafe, request more context, and avoid guessing missing content.
  BL-278 For each PATCH, the assistant MUST append a micro-logger entry that records the artefact identifier, affected location, human-readable description of DELTA, reason for change, and any risks introduced.
  BL-279 The assistant MUST NOT apply “silent fixes” or “small cleanups” without logging them as PATCHES.

============================================================
14. FEASIBILITY, FILE AWARENESS, AND HARD REFUSAL
============================================================
  BL-290 When the user bases a task on concrete artefacts such as files, folders, project file folders, attachments, specs, diaries, or logs, the assistant MUST treat those artefacts as primary sources of truth.
  BL-291 The assistant MUST NOT answer purely from general model knowledge when the user has indicated that specific artefacts or a project folder are the basis for the work.
  BL-292 When the user instructs the assistant to parse files, cross-check a master file against other files, or diff, merge, or validate a corpus, the assistant MUST explicitly acquire the relevant artefacts or confirm which artefacts are visible.
  BL-293 For artefact-based tasks, the assistant MUST inspect the artefacts to the extent required before giving any substantive answer or conclusion.
  BL-294 The assistant MUST NOT assume file content or structure that it has not actually seen.
  BL-295 For file- or corpus-based tasks, the assistant MUST state in CONTEXT_USED, and when helpful in the user-facing answer, which files or artefacts were actually used by name or path.
  BL-296 For file- or corpus-based tasks, the assistant MUST note which relevant artefacts were not seen, could not be opened, or were not processed due to limits.
  BL-297 The assistant MUST NOT claim to have processed “all files”, “the whole folder”, or “the whole corpus” when only a subset was processed; the assistant MUST name the subset instead.
  BL-298 If the requested task cannot be safely completed with the available artefacts because data is missing, unreadable, truncated, or too large, the assistant MUST say so plainly, refuse to fabricate missing parts, and log BLOCKERS and RESULT accordingly.
  BL-299 In such cases, the assistant SHOULD propose narrower or staged alternatives but MUST NOT present partial coverage as full coverage.
  BL-300 The assistant MUST NOT claim to have parsed or cross-checked artefacts it has not actually processed.
  BL-301 When the assistant narrows scope for practical reasons, it MUST state the narrowed scope to the user and MUST record the scope in CONTEXT_USED and NOTES.
  BL-302 When an instruction is impossible to satisfy as stated, given visible artefacts, session limits, or internal contradictions, the assistant MUST explain why, MUST refuse to fake a result, MUST log the situation as DEAD_END or BLOCKERS, and MAY propose smaller feasible subtasks.
  BL-303 For simple questions that do not depend on artefacts, the assistant MAY answer from general knowledge under the other sections of this bootloader.
  BL-304 As soon as the user frames work as based on a corpus, file set, or project folder, the assistant MUST obey lines BL-290 through BL-303.

============================================================
15. ASSUMPTIONS, GUESSES, AND STATEFUL EDITS
============================================================
  BL-310 The assistant MUST avoid assumptions and guesses wherever possible.
  BL-311 When progress on reasoning-only work requires an assumption, the assumption MUST be minimal and conservative.
  BL-312 Every material assumption in reasoning-only work MUST be clearly marked as an assumption in the user-facing answer.
  BL-313 Every material assumption in reasoning-only work MUST be recorded in the micro-logger in CONTEXT_USED and/or NOTES.
  BL-314 The assistant MUST distinguish between facts taken from user-provided artefacts or explicit statements and its own inferred assumptions or estimates.

  BL-315 For any operation that changes persistent artefacts, the assistant MUST NOT guess or invent missing content.
  BL-316 For stateful edits, the assistant MUST NOT assume the structure of unseen regions or fill unknown fields based on pattern completion.
  BL-317 Stateful edits MUST be based only on artefact content observed in the current session and on explicit user instructions.
  BL-318 If required context for a safe edit is missing or ambiguous, the assistant MUST treat the edit as infeasible under current information and MUST follow the hard refusal rules instead of guessing.

  BL-319 When the assistant sees only a fragment of an artefact, it MAY describe what is visible, propose clarifying questions, and outline conditional approaches, but it MUST NOT propose concrete PATCHES that depend on unseen regions.
  BL-320 Whenever an assumption influences the assistant’s reasoning, the assistant MUST log the assumption in the STEP entry and MUST indicate whether it affected only analysis or would have affected an edit.
  BL-321 When an earlier assumption is later shown to be false, the assistant MUST log the correction and MUST update NEXT_STEP to reflect revised understanding.
  BL-322 When choosing between a speculative “yes” that depends on unverified assumptions and a hard refusal due to insufficient data, the assistant MUST prefer the hard refusal.
  BL-323 The assistant MAY propose narrower safe subtasks or additional data requests but MUST NOT present assumption-heavy results as if they were grounded in actual artefacts or facts.




METADATA
TITLE: EXECUTION CHARTER
CATEGORY: GOVERNANCE / OPERATIONAL-CONTRACT
STATUS: ACTIVE
VERSION: v03.000
HASH: <fill on promotion>

0. ACTIVATION
EXEC-001 Activation triggers when user states: "parse the Diary", "load L1", "operate inside the Diary", or equivalent.
EXEC-002 On activation assistant MUST treat all BCL RIDs as law, treat ANS-001 as binding for governed outputs, treat CONFIG as runtime config, treat CORPUS as data-only, write only to CORPUS-DES001-NEW, treat CORPUS-LEGACY as immutable.
EXEC-003 When uncertain whether activation is required assistant MUST default to ACTIVATED.
EXEC-004 When Diary is absent this Charter is dormant.
EXEC-005 Activation MUST precede any governed reasoning or structural action.

1. PRECEDENCE OF SOURCES
EXEC-006 Precedence: (1) Execution Charter (2) BCL RIDs (3) CONFIG (4) CORPUS (5) Design Journal.
EXEC-007 Journal MUST NOT override any RID, Topic boundary, or this Charter.
EXEC-008 Assistants MUST NOT propose replacing RIDs unless explicitly requested.
EXEC-009 If Charter and RID conflict, the RID is authoritative.

2. TOPIC BOUNDARIES
EXEC-010 BCL = governance only. No data, no JSON, no code.
EXEC-011 CONFIG = configuration only. No RIDs, no CORPUS data.
EXEC-012 CORPUS = data only. New descriptors follow DES-001.
EXEC-013 Assistants MUST redirect content placed in wrong Topics.
EXEC-014 FMT-141 Topic/WorkSurface/SWS boundaries MUST be preserved.

3. RID GOVERNANCE
EXEC-015 ANS-001 governs answer structure, modes, Session Anchor, Task Ledger, KLOG.
EXEC-016 GOV_EDIT, structural CORPUS_EDIT, SYM-EDIT MUST use ANS-001.
EXEC-017 DES-001 governs descriptor extraction and MUST NOT be altered.
EXEC-018 SYM-001 governs symbolic engine and MUST NOT mix with descriptor domain.
EXEC-019 COR-700/701 govern consent, censorship, export, verification.
EXEC-020 FMT-141 enforces structural rules and RID boundaries.
EXEC-021 FMT-140 enforces lint and formatting rules.
EXEC-022 LOG-001 governs Session Anchor, Task Ledger, KLOG.
EXEC-023 FIH-001 governs promotions to L2/L1.

4. LAYER OPERATION
EXEC-024 L1 is immutable. No assistant modifications allowed.
EXEC-025 L2 only modified via promotion from L3.
EXEC-026 L3 is only writable layer.
EXEC-027 All structural edits originate in L3.
EXEC-028 Assistants MUST refuse any direct modification of L1.

5. DATA, JSON, MACHINE STRUCTURES
EXEC-029 RIDs MUST NOT contain live JSON, JSONL, code.
EXEC-030 Examples MUST be inert.
EXEC-031 Real JSONL MUST live outside Diary or in SPECS/CONFIG.
EXEC-032 CORPUS is append-only except migrations defined by DES-001.
EXEC-033 Helpers ONLY allowed in MACHINE_CODE or external folders.

6. DESIGN vs OPERATION MODES
EXEC-034 OPERATION MODE is default and MUST follow all RIDs.
EXEC-035 DESIGN MODE only when user explicitly requests design.
EXEC-036 Journal entries are NOT law.
EXEC-037 DESIGN MODE proposals MUST obey Topic and layer rules.
EXEC-038 Structural design in DESIGN MODE requires explicit confirmation.

7. ESCALATION RULES
EXEC-039 RID semantic edits MUST escalate to GOV_EDIT.
EXEC-040 Descriptor schema/domain edits MUST escalate to structural CORPUS_EDIT.
EXEC-041 Symbolic schema edits MUST escalate to SYM-EDIT.
EXEC-042 Escalated modes MUST use ANS-001 framing.
EXEC-043 Structural edits MUST NOT occur under CHAT, DATA, BRAINSTORM.
EXEC-044 Hidden schema drift MUST stop execution.
EXEC-045 If a lower mode produces governance effects assistant MUST reclassify.

8. RID DISCOVERY PROTOCOL
EXEC-046 Assistant MUST NOT infer RID absence from incomplete context.
EXEC-047 Assistant MUST scan entire BCL using RID header, RID ID, END OF RID, and any RID-defined regex.
EXEC-048 If full BCL scan not done RID state = unknown.
EXEC-049 If Diary is present but scan impossible assistant MUST request the file.
EXEC-050 Assistant MUST NOT fabricate missing RIDs or sections.

9. UNKNOWN-STATE RULE
EXEC-051 Missing content = unknown, NOT missing.
EXEC-052 Absence claims require full scan, missing header, missing END OF RID.
EXEC-053 Assistant MUST request file before concluding absence.

10. REQUERY MANDATE
EXEC-054 If assistant loses access or layer state it MUST request file.
EXEC-055 Cached context MUST NOT be used if Diary version changed.
EXEC-056 Assistant MUST reload and re-activate Charter after requery.

11. ANS-001 INVOCATION
EXEC-057 ANS-001 MUST govern all governed-mode outputs.
EXEC-058 Assistant MUST use canonical ANS-001 section order.
EXEC-059 Assistant MUST run RID Discovery if ANS-001 is not visible.
EXEC-060 Assistant MUST NOT fabricate ANS-001 sections.

12. CORPUS CONTRACT
EXEC-061 New descriptors MUST follow DES-001.
EXEC-062 New descriptors MUST go ONLY to CORPUS-DES001-NEW.
EXEC-063 Legacy CORPUS is immutable.
EXEC-064 Descriptor and symbolic domains MUST remain separate.

13. FUTURE-MODEL COMPATIBILITY
EXEC-065 External models share NO mutable state except LOG-001 surfaces.
EXEC-066 No model may modify L1/L2 directly.
EXEC-067 Model orchestration MUST obey Charter, ANS-001, LOG-001, DES-001, SYM-001, FMT-141.
EXEC-068 Model-driven structural actions MUST escalate to GOV_EDIT.

14. DRIFT HANDLING
EXEC-069 Drift = deviation from Charter, RIDs, or Topic boundaries.
EXEC-070 On drift detection assistant MUST stop structural work.
EXEC-071 Assistant MUST re-evaluate RID rules, boundaries, layers, and discovery.
EXEC-072 If Journal conflicts with Diary, Diary is authoritative.
EXEC-073 Assistant MUST NOT answer governed tasks until drift is resolved.

============================================================
END OF TOPIC: EXECUTION_CHARTER




RID: FMT-140
TITLE: Diary Format & Routing — Authoritative Standard (Helpers In-Diary)
CATEGORY: FORMAT / STRUCTURE
STATUS: ACTIVE
VERSION: 6.6
SHA1: <pending>

1. PURPOSE
  F140-01 Define one enforceable, machine-readable standard for rails, headers, spacing, helper routing, consent, hashing, audit, folding, and promotion.
  F140-02 Keep helpers in-diary only under Governance topics to prevent drift.
  F140-03 Use fixed, LLM-friendly IDs and rules; avoid ambiguity across assistants.
  F140-04 Separate schemas/instructions from META data; META stays machine-parseable and minimal.

2. SCOPE
  F140-10 Applies to all Governance (BCL) topics. Does not govern Corpus/Ark/Data bodies.
  F140-11 Chat previews and documentation never alter in-diary syntax.
  F140-12 New RIDs must use this template and numbering; survivors keep structure and IDs.

3. DEFINITIONS
  F140-20 Rails: the 4-line topic banner block.
  F140-21 Topic Header Block: top rail, topic line, purpose line, bottom rail = one atomic, immutable unit; edits occur strictly below.
  F140-22 END TOPIC: the exact terminator line for a topic.
  F140-23 Machine header: RID:/TITLE:/CATEGORY:/STATUS:/VERSION?:/SHA1: lines.
  F140-24 Helpers: lint rules, JSONL specs, machine code, and validators governed by explicit RID(s).
  F140-25 Helper parentage: every helper MUST declare its Parent RID in its own body. RIDs themselves have no parentage.
  F140-26 FILE block: JSONL group introduced by “FILE: <name>.jsonl”.
  F140-27 Code block: plain code beginning with “# File: <name>”.

4. NUMBERING SCHEME (LLM-OPTIMIZED)
  F140-30 Clause IDs use prefix + zero-padded numbers (F140-xx).
  F140-31 Other RIDs keep their own prefixes (e.g., C700-xx).
  F140-32 One rule per line. ASCII only. No Roman numerals or “§”.
  F140-33 RID body discipline: headings “N. TITLE” uppercase; numbering 1,2,3… with optional N.x; body indent two spaces; nested lists four spaces; tabs forbidden; empty section → single line “(none)”.

5. RAILS, HEADERS, SPACING
  F140-40 Every topic opens with the 4-line rails and closes with “==== [END TOPIC | id=…] ====”.
  F140-41 Rails and END TOPIC are immutable; no text between rails without explicit consent.
  F140-42 Encoding/normalization: UTF-8, NFC, LF only. Tabs/ZW*/BOM/CRLF forbidden → FAIL (LNT-RID-STYLE-021). No trailing spaces.
  F140-43 After “END OF RID: <RID>”, exactly five blank lines must follow in-Diary (LNT-ENDPAD-601).
  F140-44 Header key order: RID:, TITLE:, CATEGORY:, STATUS:, VERSION: (opt), SHA1:.
  F140-45 Exactly one blank line follows the last header before the body; no blank line before RID:.
  F140-46 SHA1: is the last header key; wrong order/duplicates → FAIL (LNT-RID-STYLE-011).
  F140-47 Dividers: major sections SHOULD be preceded by one line of 60–80 “-”, with one blank line above and below.
  F140-48 Line length: WARN >100 chars (LNT-RID-STYLE-031); FAIL >120 (LNT-RID-STYLE-032).

6. ROUTING — WHERE LIVE HELPERS MAY EXIST
  F140-50 Live helpers are allowed only in:
  F140-51   LINTER_RUNBOOK_RULES — rules text only; no executable code; may list lint IDs and behavior.
  F140-52   SPECS_JSONL — RAW JSONL grouped by “FILE: <name>.jsonl”; no fences.
  F140-53   MACHINE_CODE — plain code blocks starting “# File: <name>”; no fences.
  F140-54 Outside these three topics, parseable JSON and executable code are FORBIDDEN; use deconstructed examples.
  F140-55 Within the BCL, live executable code is prohibited except for RID machine headers and deconstructed examples/templates.
  F140-57 Enforcement: BCL violations = FAIL. Outside-BCL placement = WARN with relocation suggestion; do not block promotion solely for placement.

7. FENCES & EXAMPLES POLICY
  F140-60 Triple backticks are forbidden inside the three helper topics.
  F140-61 Fences may appear elsewhere only for non-executable, illustrative snippets.
  F140-62 In examples, use deconstructed tokens for rails/JSON/code; the literal “END OF RID:” may appear only when split/concatenated.
  F140-63 Safe deconstruction patterns:
           "RID"+": EXAMPLE-000"
           "TITLE"+": Example Only"
           "{"+"\"k\""+":"+"\"v\""+"}"
           "==== "+"[TOPIC: "+"<NAME>"+" | id="+"<ID>"+"]"+" ===="

8. GOVERNED HELPERS INDEX (RIDs LIST WHAT THEY GOVERN)
  F140-70 Any RID that governs helpers MUST include an index in its body enumerating each governed helper with fields:
           name, type∈{LINT,JSONL,CODE,DATA}, routed_topic∈{LINTER_RUNBOOK_RULES,SPECS_JSONL,MACHINE_CODE}, purpose, enforces:[IDs].
  F140-71 This index documents authority only; it does not substitute helper-side parentage.
  F140-72 Missing or stale entries in the index → FAIL at promotion.

9. HELPER PARENTAGE (DECLARED IN HELPERS)
  F140-80 All helpers MUST declare parentage in-place:
  F140-81 JSONL row fields include {"parent_rid":"<RID>"} and MAY include {"enforces":["F140-.."]}.
  F140-82 Lint blocks include a visible line “Governing Rule: <RID>” and MAY list “Enforces: <IDs>”.
  F140-83 Machine code begins with a header comment: # Parent RID: <RID> | Enforces: <IDs>.
  F140-84 Missing parentage → FAIL.

10. HELPER PLACEMENT WAYFINDER (EMBEDDED, DECONSTRUCTED)
  F140-90 This RID embeds the canonical wayfinder to show that the 4-line banner is one atomic header and that helpers belong strictly below the bottom rail.
  F140-91 Routed topics are those in §6. No helper content may appear between the top and bottom rails of any topic.
  F140-92 Embedded wayfinder (non-live; deconstructed, all four lines):
    "==== " + "<top rail reproduced as spaces>" + "===="
    "==== " + "[TOPIC: " + "<ROUTED_TOPIC_NAME>" + " | id=" + "<ROUTED_TOPIC_ID>" + "]" + " ===="
    "Purpose: " + "<topic purpose text>"
    "==== " + "<bottom rail reproduced as spaces>" + "===="
  F140-93 Lint scope: presence of §10 inside this RID is REQUIRED (LNT-WAYFINDER-401 for FMT-140). Reconstructing live rails inside any RID body is FORBIDDEN (LNT-WAYFINDER-402).

11. LINT HOOKS (AUTHORITATIVE INDEX)
  F140-100 Lint lives in LINTER_RUNBOOK_RULES and cites “Governing Rule: FMT-140”.
  F140-101 Required IDs include:
            LNT-RID-STYLE-001/002/011/021/031/032/041/042/051/061/071/081,
            LNT-META-GRAMMAR-201,
            LNT-XCHK-301/302/303/304,
            LNT-PLACEMENT-501,
            LNT-ENDPAD-601,
            LNT-NORMALIZE-701,
            LNT-LINTPAD-611/612,
            LNT-JSOLPAD-621/622,
            LNT-MCPAD-631/632,
            LNT-BCL-CODE-802,
            LNT-BCL-JSOL-803,
            LNT-ROUTING-820.
  F140-102 Spacing pads: lint blocks have one blank line above and exactly two below (LNT-LINTPAD-611/612).

12. SPECS (JSONL)
  F140-110 Specs governed by this RID live only in SPECS_JSONL.
  F140-111 Each FILE block MUST start with “FILE: <name>.jsonl”.
  F140-112 Each FILE block MUST contain ≥1 JSONL row; empty FILE → FAIL (LNT-BCL-JSOL-803).
  F140-113 Spacing: one blank line immediately above each FILE; exactly two blank lines below each FILE.
  F140-114 Specs MUST NOT create or modify topics, rails, categories, or machine headers without explicit consent.
  F140-115 “Declaration lines” include Template-Index entries that emit *.jsonl names; pad them per F140-113.

13. MACHINE CODE
  F140-120 Code lives only in MACHINE_CODE.
  F140-121 Each helper starts with “# File: <name>” and carries the Parent RID header comment per F140-83.
  F140-122 Spacing: one blank line immediately above each helper header; exactly two blank lines below the declaration line.
  F140-123 Helpers may verify and perform spacing-only autofix; no semantic edits without explicit consent (see COR-701).

14. CONSENT & NON-CREATION GUARANTEE
  F140-130 No RID, lint, spec, or code may create/modify topics, banners, categories, or machine headers without explicit user consent and visible NOTICE.
  F140-131 Absent consent, artifacts operate read-only: verify/lint/emit previews; no structural creation/edit.
  F140-132 Consent MUST be recorded in the Task Ledger before emission.

15. META & NORMALIZATION (RIDs THAT GOVERN HELPERS)
  F140-140 A META block is REQUIRED in RIDs that govern helpers; allowed keys and fixed order:
            refs, tags, emitted_files, hash, legacy_ok, notes, deprecation_map.
  F140-141 ASCII only; arrays use [ … ], comma+space; one key per line; no blank lines between keys. Wrong order/keys → FAIL (LNT-META-GRAMMAR-201).
  F140-142 Normalize to NFC, UTF-8, LF only. Tabs/ZW*/BOM/CRLF forbidden → FAIL (LNT-RID-STYLE-021).
  F140-143 Minified-body SHA1: drop blank lines; trim; collapse internal spaces; remove all spaces/newlines; hash UTF-8 bytes. META.hash records SHA1(minified_body) at promotion.

16. CROSS-CHECK, LEDGER, INTEGRITY, SIDECARS, FOLDS
  F140-150 Cross-check new/edited RIDs against {COR,FMT,FIH,LOG,LNT,FIT,SPECS,MACHINE_CODE}.
  F140-151 Fail codes:
            FMT140-XCHK-001 overlap without reference;
            FMT140-XCHK-002 weaker duplicate present;
            FMT140-XCHK-003 survivor missing backward enforcement;
            FMT140-XCHK-004 missing cross-check vs FMT-140.
  F140-152 Helper emissions MUST append a Task Ledger entry per COR-701 (timestamp, action, sha1s, ranges, operator, consent, validation).
  F140-153 Integrity chain recomputed at L3→L2 and L2→L1; mismatch → BLOCK (per COR-701).
  F140-154 Sidecars are export-only audit artifacts; never replace or modify in-diary content; not required for execution. If no export, no sidecars.
  F140-155 No alias maps on folds; update all references to the survivor; survivor must continue enforcing prior helper behaviors.

17. OUTPUTS (TEMPLATES & EMIT SLOTS)
  F140-160 OUTPUTS is the sole location for template declarations governed by this RID.
  F140-161 Template Index format:
            "TEMPLATE" + "|" + <KIND> + "|" + <NAME> + "|" + "Version=" + <semver> + "|" + "Emit=" + <filename>
            KIND ∈ {JSONL, VFILE, DATA}. NAME is an ASCII slug. Filenames ASCII and deterministic.
  F140-162 Templates here are deconstructed; live RAW JSONL goes to SPECS_JSONL; plain code goes to MACHINE_CODE.
  F140-163 Acceptance Tests lines (textual), one per line: "AT" + "|" + <ID> + "|" + "Expect=" + <predicate>.
  F140-164 META.emitted_files MUST list filenames declared in the Template Index.

18. RELATIONS
  F140-170 Binding/mirrored: FMT-141 (headers/topics/consent), FIH-001 (files, integrity, AUTO-KLOG), COR-700/701 (determinism/verification), ANS-001 (answer governance), RBS-050 (routing policy).

19. META
  refs: ["FMT-141","FIH-001","COR-700","COR-701","ANS-001","RBS-050"]
  tags: ["fencing","placement","style","helpers","routing","lint","jsonl","machine-code","consent","hashing","audit","folding","promotion"]
  emitted_files: ["fmt140_lint_config.jsonl","fmt140_jsol_schema.jsonl","fmt140_enforcement_matrix.jsonl","fmt140_parentage.jsonl","fmt140_examples_ttpl.jsonl"]
  hash: "<fill at promotion>"
  legacy_ok: []
  notes: "RIDs list governed helpers (§8); helpers declare parentage (§9). Embedded helper-placement wayfinder (§10). Routing (§6)."

END OF RID: FMT-140





RID: FIH-001
TITLE: FILE, INTEGRITY, AND HANDLING — DETERMINISTIC NAMING, PROMOTIONS, MANIFESTS, AND LINK CHECKS
CATEGORY: GOV / FILES
STATUS: ACTIVE
SHA1: <pending>

1. PURPOSE
  F001-01 Define deterministic rules for artifact naming, integrity verification, link delivery, and promotion flow across L3, L2, and L1.
  F001-02 Delegate all logging, KLOG, and retention mechanics to LOG-001.
  F001-03 Prevent file-not-found errors, stale preview confusion, and layer-write errors.

2. SCOPE
  F001-04 Applies to all emitted artifacts: canonical diaries, previews, data artifacts, and manifests.
  F001-05 Editing is permitted only in L3; L1 and L2 are read-only promotion targets.
  F001-06 Excludes logging schema and retention; see LOG-001.

3. DEFINITIONS
  F001-07 Artifact = any file emitted by Diary operations.
  F001-08 Version = v.mm.ggg.ddd with zero-padded mm(2), ggg(3), ddd(3).
  F001-09 Artifact Manifest = JSON with fields {mode, origin_layer, promotion_path, layer, op, window, anchors, pre_sha1, post_sha1, line_delta, rid_counts, links[], paths[], timestamp_local, timestamp_utc, tz_local, filename, full_path, size_bytes, mime_hint, version_parse:{mm,ggg,ddd}, collision_flag, write_mode, dst_token, link_echo}.
  F001-10 Origin Layer = the layer where an operation executes; valid value is L3 only.
  F001-11 Promotion Path = L3->L2 or L2->L1; reverse or lateral writes are forbidden.
  F001-12 User-Sourced Draft (USD) = any input whose basename starts with USER_ or USER_EDITS_; L3 intake only, never emitted as-is.
  F001-13 Preview (full Diary) = whole Diary with proposed edits in L3 for drift/context review.
  F001-14 Task Snippet = isolated extract of the exact changes performed in a task, plus proof metadata.

4. NAMING RULES
  F001-20 Canonical filename pattern: The_Prompt_Diaries_vmm.ggg.ddd_YYYY-MM-DD_HH-MM_CET|CEST.txt
  F001-21 Canonical regex: ^The_Prompt_Diaries_v\d{2}\.\d{3}\.\d{3}_\d{4}-\d{2}-\d{2}_\d{2}-\d{2}_(CET|CEST)\.txt$
  F001-22 Preview filename pattern: PREVIEW_<TASK>_<IT>_The_Prompt_Diaries_vmm.ggg.ddd.txt
  F001-23 Preview regex: ^PREVIEW_[A-Z0-9_]{3,40}_\d{2}_The_Prompt_Diaries_v\d{2}\.\d{3}\.\d{3}\.txt$
  F001-24 Data filename pattern: DATA_<TASK>_The_Prompt_Diaries_vmm.ggg.ddd.txt
  F001-25 Data regex: ^DATA_[A-Z0-9_]{3,40}_The_Prompt_Diaries_v\d{2}\.\d{3}\.\d{3}\.txt$
  F001-26 Tokens: TASK=[A-Z0-9_]{3,40} (no leading/trailing underscore, no double underscores). IT=\d{2} (00–99).
  F001-27 ASCII only. No spaces. Use underscores as separators. Hyphens allowed only inside the timestamp.
  F001-28 Ad-hoc prefixes/suffixes outside patterns are forbidden.
  F001-29 Filename–header parity required; mismatch fails gates.
  F001-30 Preview filename (full Diary): PREVIEW_<TASK>_<IT>_The_Prompt_Diaries_vmm.ggg.ddd.txt
  F001-31 Task Snippet filename: TASK_SNIPPET_<TASK>_<IT>_The_Prompt_Diaries_vmm.ggg.ddd.txt
  F001-32 Regex (Task Snippet): ^TASK_SNIPPET_[A-Z0-9_]{3,40}_\d{2}_The_Prompt_Diaries_v\d{2}\.\d{3}\.\d{3}\.txt$

5. VERSION SEMANTICS
  F001-40 Version uses v.mm.ggg.ddd.
  F001-41 Governance promotion that changes governing content increments ggg and resets ddd=000 at L3->L2; this ggg persists to L1.
  F001-42 Data work never changes ggg; data operations may increment ddd only.
  F001-43 Rollback rule: ggg is authoritative for ordering; higher ggg supersedes any ddd.

6. LINK DELIVERY AND INTEGRITY
  F001-50 Each delivered artifact must include a clickable Markdown link with visible text equal to the exact filename.
  F001-51 Print SHA1 on the same line as the link.
  F001-52 Echo the raw filesystem path on the next line as plain text.
  F001-53 Click test: after emission, open the linked path read-only and verify readability.
  F001-54 Link text filename must match the link target basename byte-for-byte.
  F001-55 Failure of F001-50..F001-54 blocks promotion and delivery.

7. PATH AND STORAGE POLICY
  F001-60 Storage root is /mnt/data/.
  F001-61 No relative .. segments. No symlinks. Flat layout unless a task-specific subfolder is declared; subfolder names mirror TASK.
  F001-62 Max basename length 140 bytes. ASCII only.
  F001-63 Reserved characters forbidden: space, :, *, ?, ", <, >, |, \, and double dots.

8. WRITE SAFETY
  F001-70 Atomic write: write to a temp file in L3, fsync, then rename to the final name.
  F001-71 No overwrite: if the destination exists, fail with COLLISION.
  F001-72 Timestamp source for canonical filenames is Brussels local (CET/CEST); manifests record both local and UTC times.
  F001-73 Encoding must be UTF-8, Unicode NFC, LF newlines. CRLF forbidden.
  F001-74 L1/L2 write protection: open L1/L2 only read-only; creation or replacement occurs via promotion rename from L3.

9. INTEGRITY GATES
  F001-80 Artifact must exist, be readable, and size>0.
  F001-81 Compute SHA1 before and after content-affecting operations.
  F001-82 All referenced links must resolve at emission time.
  F001-83 Write-layer check: Origin Layer must be L3.
  F001-84 Target-layer check: any attempt to write to L1 or L2 fails with FORBIDDEN_LAYER_WRITE.
  F001-85 Parity check: filename version equals header version; mismatch fails.
  F001-86 Diff proof: record added, removed, moved line counts and windows touched; zero-delta fails with NO_CHANGE_BLOCK.
  F001-87 Task Snippet parity: snippet content must be a strict subset or exact diff representation of the paired Preview; mismatch fails.
  F001-88 Base proof: Preview and Snippet must record base canonical filename + SHA1.
  F001-89 Window proof: Snippet must list exact line ranges and topic ids touched.

10. PROMOTION GATES
  F001-90 Only promotions may create or replace L2 or L1 artifacts.
  F001-91 L3->L2 requires naming PASS, integrity PASS, clickable link PASS, manifest emitted, and pillar lints PASS (no FAIL).
  F001-92 L2->L1 requires all F001-91 gates plus stability attestation.
  F001-93 Direct edit detection: if an L1 or L2 SHA1 changes without a manifest citing a valid Promotion Path, emit TAMPER_DETECTED and halt.
  F001-94 After any task completes: emit Preview and Task Snippet before seeking promotion.
  F001-95 On promotion: emit the promoted canonical file in addition to Preview/Snippet; no extra consent needed to emit files.

11. USER-SOURCED DRAFTS
  F001-100 USD intake allowed as L3 inputs only; never emitted as-is.
  F001-101 Normalize USD to a Preview name on first touch; remove USER_* prefix; choose the next IT.
  F001-102 Manifest must include usd_source=true and usd_original_path.
  F001-103 Governance promotion from a USD follows F001-41 (ggg+1, ddd=000) at L3->L2; do not bump again at L2->L1.
  F001-104 Data-only USDs follow F001-42; do not change ggg.

12. PROCESS
  F001-110 Execute edits in L3 only.
  F001-111 Ensure exactly one active Preview per TASK × Version; new Previews supersede the prior one (and its Snippet).
  F001-112 Before delivering a Preview, compare SHA1 with the last delivered Preview; if equal, block as NO_CHANGE.
  F001-113 Emit a one-line delta summary: Δlines=+X/−Y; RIDs_touched=N; anchors_ok.
  F001-114 Promote L3->L2, then optionally L2->L1. No direct L3->L1.
  F001-115 After promotion, verify filename parity and SHA1 read-only, then print links.

13. IMMUTABILITY AND ROLLBACK
  F001-120 Canonical immutability: once emitted, canonical contents must not change; corrections require a new version per section 5.
  F001-121 Quarantine orphans: artifacts that fail section 4 or 5 are quarantined and not linked.
  F001-122 Superseded Previews must be archived and referenced once with SHA1.

14. PROHIBITIONS
  F001-130 No create/write/append/truncate in L1 or L2 by non-promotion operations.
  F001-131 No multiple manifests per operation.
  F001-132 No USER_* prefixes in emitted artifact names.
  F001-133 No alias maps or softlinks for artifacts.
  F001-134 No task completes without emitting both Preview and Task Snippet.

15. LINT
  F001-140 Enforce section 4 regexes against filenames; fail on mismatch.
  F001-141 Fail if any link line is missing, not clickable, or link text ≠ filename.
  F001-142 Fail if open/read test fails or size==0.
  F001-143 Fail if SHA1 not printed next to each link.
  F001-144 Fail if manifest.origin_layer ≠ L3 or promotion_path missing when destination is L2 or L1.
  F001-145 Fail on any write handle opened to L1 or L2.
  F001-146 Warn on MIME/extension mismatch.
  F001-147 Emit LINK_CHECK table in manifest for each delivered artifact.
  F001-148 Fail if Task Snippet lacks base canonical + SHA1, window ranges, or delta summary.
  F001-149 Fail if Snippet SHA1/diff does not correspond to the paired Preview.

16. HELPERS
  F001-150 Helper placement follows FMT-140 topics.
  F001-151 Linter rules live under LINTER — RUNBOOK & RULES and declare Governing Rule: FIH-001.
  F001-152 Specs JSONL live under SPECS (JSONL) and declare Governing Rule: FIH-001.
  F001-153 Machine-code checkers live under MACHINE CODE HELPERS and declare Governing Rule: FIH-001.
  F001-154 Helpers must assert L1/L2 read-only access during verification and perform promotion via atomic rename from L3.

17. META
  F001-160 refs: ["LOG-001","FMT-140","FMT-141","COR-700","COR-701"]
  F001-161 tags: ["files","integrity","naming","promotion","manifest","links","delegation","immutability"]
  F001-162 emitted_files: ["fih-001_regex_tests.jsonl","fih-001_manifest_schema.jsonl","fih-001_linkcheck_examples.txt","task_snippet_schema.jsonl","snippet_example.txt"]

END OF RID: FIH-001.





RID: FMT-141
TITLE: Topic Structure, WorkSurfaces, Sub-Work-Surfaces, Helpers, Folding
CATEGORY: FORMAT / STRUCTURE
STATUS: ACTIVE
SHA1: <populate at promotion>

============================================================
1. PURPOSE
============================================================
  F141-01 Define structural law for Topic headers, Topic header-blocks, WorkSurfaces, Topic_Body_Sub_Surfaces, Functional Sub-Work-Surfaces, END markers, metadata, helper-parenting, folding, and RID construction.
  F141-02 Ensure Topics and RIDs are deterministic, stable in their boundaries, helper-stable, and machine-parsable.
  F141-03 Replace legacy BODY-block architecture with a universal WorkSurface + TopicBodySWS + Functional Sub-Work-Surface system while preserving prior enforcement intent and functional outcomes, except where explicitly strengthened.
  F141-04 Provide structural guarantees for all governance, operational, and corpus Topics.

============================================================
2. SCOPE
============================================================
  F141-10 Applies to all RIDs.
  F141-11 Applies to all Topics within the Diary.
  F141-12 Applies to all helpers, lints, formatters, and structural tools.
  F141-13 Applies to append-only logging Topics and multi-block Topics.
  F141-14 Applies to RID folding and helper-parenting systems.

============================================================
3. DEFINITIONS
============================================================
  F141-20 Topic_Header_Block = contiguous four-line block: top rail, topic line, purpose line, bottom rail. This block is atomic and immutable.
  F141-21 WorkSurface = the closed interval of lines strictly between the bottom rail of the Topic_Header_Block and the matching END_TOPIC marker for the same id. The four header lines and the END_TOPIC line are not part of the WorkSurface.
  F141-22 Sub_Work_Surface = contiguous block of lines fully contained inside the WorkSurface, delimited by a SubSurfaceHeader and SubSurfaceFooter whose identifiers match exactly.
  F141-22A Topic_Body_Sub_Surface (TopicBodySWS) = the unique Sub_Work_Surface that wraps the full logical body of a Topic. It MUST use the identifier "<TOPIC-ID>-BODY" and MUST span from the first to the last non-blank line in the WorkSurface.
  F141-22B Functional_Sub_Work_Surface = any Sub_Work_Surface other than the TopicBodySWS. Functional_Sub_Work_Surfaces group content by function (e.g., NOTES, PROFILES, DOMAINS, INDEX, LOG, DES001-NEW, LEGACY-DATA) and are the only zones where assistants and helpers may write.
  F141-23 SubSurfaceHeader = line with exact form: "[[SUB: " + "<TOPIC-ID>" + "-" + "<NAME>" + "]]".
  F141-24 SubSurfaceFooter = line with exact form: "[[/SUB: " + "<TOPIC-ID>" + "-" + "<NAME>" + "]]".
  F141-25 <TOPIC-ID> MUST match the Topic_Header_Block id exactly. <NAME> MUST be a unique ASCII slug within that Topic using [A–Z,a–z,0–9,_,-].
  F141-26 END_TOPIC marker = terminating Topic line with exact form "==== [END TOPIC | id=<TOPIC-ID>] ====" and id identical to Topic_Header_Block id.
  F141-27 END_RID marker = terminating RID line with exact form "END OF RID: <RID-ID>" where <RID-ID> matches the RID header.
  F141-28 META = RID metadata block.
  F141-29 Helper = deterministic external file that implements parent-RID structural behaviour.
  F141-30 Folding = consolidation of overlapping RIDs into a single survivor.
  F141-31 Wayfinder = non-normative structural diagram that may depict Topics, WorkSurfaces, TopicBodySWS, and Functional_Sub_Work_Surfaces only in deconstructed (non-live) form.

============================================================
4. TOPIC HEADER BLOCK
============================================================
  F141-30 Each Topic MUST contain exactly one Topic_Header_Block.
  F141-31 Topic_Header_Block MUST consist of exactly four lines: top rail, topic line, purpose line, bottom rail.
  F141-32 Topic_Header_Block lines MUST NOT be altered without explicit user authorization.
  F141-33 No content MAY appear between any of the four Topic_Header_Block lines.
  F141-34 Topic line MUST use exact form: "==== [TOPIC: <NAME> | id=<ID>] ====".
  F141-35 Purpose line MUST use exact form: "Purpose: <short-text>".
  F141-36 ID in Topic_Header_Block MUST be unique within the Diary.
  F141-37 Topic_Header_Block MUST be treated as an indivisible atomic unit.
  F141-38 No assistant or helper MAY insert, rewrite, or delete any Topic_Header_Block line without explicit user authorization.
  F141-39 Topic rails MUST match width defined by FMT-140.
  F141-40 Assistants and helpers that render any Topic_Header_Block in output (including previews, summaries, or structural diagrams) MUST render all four lines of the Topic_Header_Block together. Rendering only a subset of these lines MUST be treated as a display error, even if the underlying Topic structure is valid.

============================================================
5. END MARKERS
============================================================
  F141-50 Each Topic MUST contain exactly one END_TOPIC marker.
  F141-51 END_TOPIC marker MUST use exact form: "==== [END TOPIC | id=<ID>] ====".
  F141-52 END_TOPIC id MUST match Topic_Header_Block id exactly.
  F141-53 No Topic content MAY appear after the END_TOPIC marker.
  F141-54 No assistant or helper MAY alter an END_TOPIC marker without explicit user authorization.
  F141-55 Each RID MUST terminate with a single-line RID footer.
  F141-56 The RID footer MUST use exact form: "END OF RID: <RID-ID>".
  F141-57 <RID-ID> in the RID footer MUST match the RID ID in the RID header exactly.
  F141-58 No RID content MAY appear after the RID footer line within the file.
  F141-59 Assistants and helpers MUST NOT create, modify, or remove RID footer lines without explicit user authorization.

============================================================
6. WORKSURFACE, TOPIC BODY, AND SUB-WORK-SURFACES
============================================================
  F141-60 Every Topic MUST contain exactly one WorkSurface (as defined in F141-21).
  F141-61 Every Topic MUST contain exactly one TopicBodySWS fully contained inside its WorkSurface. The TopicBodySWS MUST:
             a) use the identifier "<TOPIC-ID>-BODY"; and
             b) span from the first non-blank line in the WorkSurface to the last non-blank line in the WorkSurface.
  F141-62 All Functional_Sub_Work_Surfaces for a Topic MUST be fully contained inside that Topic’s TopicBodySWS.
  F141-63 Sub_Work_Surface identifiers MUST be Topic-specific: "<TOPIC-ID>-<NAME>". <TOPIC-ID> MUST equal the Topic_Header_Block id. <NAME> MUST be unique within that Topic.
  F141-63A SubSurfaceHeader and SubSurfaceFooter lines MUST contain no characters other than the exact ASCII sequences defined in F141-23 and F141-24. No leading or trailing whitespace, no prefixes, and no suffixes are permitted.
  F141-63B SubSurfaceHeader and SubSurfaceFooter for a given "<TOPIC-ID>-<NAME>" MUST both lie within the same WorkSurface for that <TOPIC-ID>. Cross-WorkSurface or cross-Topic pairing is forbidden.
  F141-63C <NAME> MUST NOT begin or end with "-" or "_" and MUST NOT contain whitespace. Only the characters [A–Z,a–z,0–9,_,-] are permitted.
  F141-64 Functional_Sub_Work_Surfaces MUST NOT overlap or nest each other. A WorkSurface line MAY belong simultaneously to:
             a) the TopicBodySWS; and
             b) at most one Functional_Sub_Work_Surface.
  F141-65 The SubSurfaceHeader of the TopicBodySWS MUST be the first non-blank line inside the WorkSurface. The SubSurfaceFooter of the TopicBodySWS MUST be the last non-blank line inside the WorkSurface. Blank lines MAY appear inside the TopicBodySWS but MUST NOT appear outside it within the WorkSurface.
  F141-66 Assistants and helpers MUST write only inside Functional_Sub_Work_Surfaces. Writing directly in the WorkSurface outside the TopicBodySWS is forbidden. Writing directly inside the TopicBodySWS but outside any Functional_Sub_Work_Surface is forbidden for assistants and helpers.
  F141-67 Assistants and helpers MUST NOT insert, modify, or delete any of the four Topic_Header_Block lines, the END_TOPIC line, or any non-blank WorkSurface line that lies outside the TopicBodySWS.
  F141-68 Creation, renaming, or deletion of any Sub_Work_Surface header or footer lines (including the TopicBodySWS) MUST require explicit user authorization and MUST be treated as structural edits governed by COR-701.
  F141-69 Per-Topic rules MAY designate individual Functional_Sub_Work_Surfaces as append-only, editable, or machine-only. Once declared, assistants and helpers MUST obey these local rules.
  F141-70 Functional_Sub_Work_Surfaces that are designated append-only by their Topic definition MUST NOT be rewritten or merged. Allowed operations on such Functional_Sub_Work_Surfaces are limited to:
             a) appending new lines at the bottom; and
             b) whitespace-only fixes explicitly authorised by the user.
  F141-71 All Sub_Work_Surfaces MUST be plain text only. Sub_Work_Surfaces MUST NOT contain executable code.
  F141-72 Sub_Work_Surfaces MUST NOT contain schemas, JSON, or JSONL rows. Any structured formats (schemas, JSONL, code) MUST live in Topics or blocks explicitly governed by other RIDs (e.g., SPECS_JSONL, MACHINE_CODE).
  F141-73 Legacy BODY-block semantics are preserved and strengthened as follows:
             a) any Topic that still contains a legacy BODY-block MUST treat that BODY-block as the TopicBodySWS for that Topic; and
             b) all constraints that applied to BODY-blocks in prior versions (append-only, no code, no schemas/JSON, fenced-only writing) now apply to all TopicBodySWS and Functional_Sub_Work_Surfaces.

============================================================
7. MULTI-BLOCK TOPICS
============================================================
  F141-70 Topics MAY define multiple Functional_Sub_Work_Surfaces within the same TopicBodySWS. Each Functional_Sub_Work_Surface SHOULD have a clear functional role (e.g., LOG, INDEX, NOTES, PROFILES, DOMAINS) documented in that Topic’s local schema or comments.
  F141-71 Topics that define multiple Functional_Sub_Work_Surfaces MUST NOT contain any non-blank WorkSurface content outside the TopicBodySWS, and the TopicBodySWS MUST NOT contain any non-blank text that lies outside a Functional_Sub_Work_Surface, except for comments and section separators explicitly allowed by the governing Topic or RID.
  F141-72 Functional_Sub_Work_Surface names SHOULD reflect their role (e.g., "<TOPIC-ID>-LOG", "<TOPIC-ID>-INDEX", "<TOPIC-ID>-NOTES", "<TOPIC-ID>-DES-001-GLOBAL") while obeying the identifier rules in F141-63.
  F141-73 Assistants MUST write only inside the specific Functional_Sub_Work_Surface designated for the task when the Topic defines separate Functional_Sub_Work_Surfaces for different purposes.
  F141-74 Structural tools MAY rely on Functional_Sub_Work_Surface naming patterns to route logs, indexes, and machine-readable regions, but MUST NOT infer behaviour beyond what the parent Topic and parent RID define.
  F141-75 Functional_Sub_Work_Surfaces MUST group content by function, not by individual row. A RID or helper that writes rows for a given function (e.g., poses, lighting descriptors, symbolic profiles) MUST use a shared Functional_Sub_Work_Surface for that function instead of creating one Sub_Work_Surface per row or per tiny fragment.

============================================================
8. TOPIC STRUCTURE PROTECTION
============================================================
  F141-80 Assistants MUST NOT create new Topics without explicit user authorization.
  F141-81 Assistants MUST NOT delete Topics.
  F141-82 Assistants MUST NOT rename Topic ids.
  F141-83 Assistants MUST NOT move Topic boundaries.
  F141-84 Assistants MUST NOT insert rails, Topic header lines, or END_TOPIC markers.
  F141-85 Topic structure (Topic_Header_Block, WorkSurface extent, END_TOPIC) MUST remain stable across edits, except when explicitly modified under COR-701 structural gates.
  F141-86 Topic detection MUST rely on exact id matches.

============================================================
9. CROSS-RID STRUCTURAL BOUNDARIES
============================================================
  F141-90 RIDs MUST NOT rely on another RID for their operative meaning.
  F141-91 RIDs MAY reference another RID only for provenance.
  F141-92 RIDs MUST NOT import behaviour from other RIDs.
  F141-93 Structural domains MUST remain independent: FMT for formatting, LOG for logging, COR for consent, ANS for answer governance, other domain RIDs for their own behaviour.
  F141-94 Structural conflicts MUST be resolved by the following priority:
             a) FMT-140 governs formatting,
             b) FMT-141 governs Topic and RID structure,
             c) LOG-001 governs logging,
             d) COR-701 governs consent,
             e) domain RID governs its own domain behaviour.
  F141-95 No RID MAY override FMT-141 Topic or RID structure rules.

============================================================
10. RID STRUCTURE & ATOMICITY
============================================================
  F141-110 Each RID MUST consist of PURPOSE, SCOPE, structural sections, a WAYFINDER section, and META.
  F141-111 RID sections MUST appear in ascending numeric order.
  F141-112 Clause numbering within a RID SHOULD be continuous and strictly increasing within each major section. Where legacy numbering conflicts exist, new clauses MUST NOT create ambiguity about which text is operative and SHOULD avoid reusing existing clause numbers.
  F141-113 Each clause MUST contain exactly one atomic instruction.
  F141-114 Lists MAY be used only if all bullets implement one atomic requirement.
  F141-115 RID text MUST be ASCII-only.
  F141-116 RID text MUST NOT contain JSONL, schemas, code, or templates.
  F141-117 RID text MUST NOT contain executable logic.
  F141-118 RID MUST be structurally self-sufficient: no external documents required for interpretation of obligations, aside from non-normative Wayfinder diagrams governed by F141-230..F141-239.
  F141-119 The WAYFINDER section of a RID MUST follow the non-normative diagram rules in Section 15 and MUST be treated as descriptive only; all binding obligations MUST live in the main RID sections, not in Wayfinder diagrams.

============================================================
11. META RULES
============================================================
  F141-130 META MUST contain refs, tags, emitted_files, hash, legacy_ok, notes.
  F141-131 META.refs MUST NOT create behavioural dependencies.
  F141-132 META.tags MUST be descriptive single tokens.
  F141-133 META MUST NOT contain structured schemas.
  F141-134 META MUST NOT require external files for the RID to be operative.

============================================================
12. HELPER-PARENTING
============================================================
  F141-150 Helpers MUST declare their parent RID.
  F141-151 Helpers MUST NOT modify RID body text.
  F141-152 Helpers MUST NOT redefine rails, Topic headers, END markers, WorkSurface bounds, TopicBodySWS fences, or Functional_Sub_Work_Surface fences.
  F141-153 Helpers MUST operate only within their declared interface.
  F141-154 Helpers MUST NOT create new Topics or Sub_Work_Surfaces.
  F141-155 Helpers MUST NOT import code into RIDs.
  F141-156 Helpers MUST be rebuildable from parent RID text alone.
  F141-157 Helpers MUST NOT expand parent RID behaviour beyond what is defined in the RID.

============================================================
13. RID_CHANGE ARTIFACTS
============================================================
  F141-170 Any RID modification MUST generate at least one RID_CHANGE artifact.
  F141-171 For each RID modification, assistants and helpers operating in an interactive environment (e.g., chat) MUST emit:
             a) a RID_CHANGE artifact rendered in a plain-text codeblock that contains RID_CHANGE header fields and change_summary; and
             b) a RID_CHANGE artifact written to a plain-text file on disk using an implementation-defined path and a filename that includes the RID id and version (e.g., "RID_CHANGE_<RID-ID>_<VERSION>.txt").
  F141-172 The on-disk RID_CHANGE text file MUST contain:
             a) the full RID_CHANGE header (RID_CHANGE id, VERSION, TIMESTAMP, AUTHOR);
             b) the complete change_summary (including strictness_diff); and
             c) an old_body section that contains the full prior RID text body for the modified RID, in plain ASCII, followed by an "END OF RID_CHANGE: <RID-ID>" footer line.
  F141-173 The interactive RID_CHANGE codeblock artifact MUST contain:
             a) the RID_CHANGE header (RID_CHANGE id, VERSION, TIMESTAMP, AUTHOR); and
             b) the complete change_summary (including strictness_diff);
           and MUST NOT embed the full old RID body. The codeblock MAY instead refer to the old_body via a reference to the on-disk RID_CHANGE text file or to the source RID file.
  F141-174 RID_CHANGE artifacts (both on-disk files and codeblocks) MUST be append-only, deterministic, and ASCII-only.
  F141-175 RID_CHANGE artifacts MUST NOT contain executable code or JSON. List-like structures MUST be plain text only.
  F141-176 RID_CHANGE artifacts MUST be produced before promotion of the modified RID body to L1.
  F141-177 RID modifications MUST preserve prior obligations, enforcement stance, and effective functional outcome unless an explicit governance decision is made to relax, replace, or invert them. Such decisions MUST be recorded clearly in RID_CHANGE.change_summary.
  F141-178 If any obligation is weakened, removed, or inverted, RID_CHANGE.change_summary MUST include a strictness_diff subsection that enumerates:
               a) clauses that became stricter,
               b) clauses that stayed equivalent, and
               c) clauses that became weaker or were removed.
           COR-701 non-regression checks apply to this comparison.
  F141-179 RID_CHANGE artifacts themselves are not subject to RID_CHANGE; they are append-only logs. Subsequent modifications to the same RID MUST generate new RID_CHANGE artifacts that refer back to the immediately prior RID body, not to prior RID_CHANGE artifacts.

============================================================
14. FOLDING SYSTEM
============================================================
  F141-200 RID overlap occurs when two RIDs govern the same domain, process, or structural responsibility.
  F141-201 Folding MUST absorb all overlapping intent from the folded RIDs into the survivor RID.
  F141-202 Folding MUST NOT drop any obligations from the folded RIDs.
  F141-203 Folding MUST NOT introduce new behaviour; adding obligations is a separate governance edit.
  F141-204 Survivor selection MUST follow:
               a) RID with broader scope survives,
               b) if equal scope → most recently refactored RID survives,
               c) if still equal → user decision required.
  F141-205 Folded RIDs become archival metadata only.
  F141-206 Survivor RIDs MUST present one continuous clause numbering sequence after folding.
  F141-207 Helpers attached to folded RIDs MUST be rebound to the survivor RID.
  F141-208 META of survivor RID MUST contain folded_from field listing absorbed RIDs.
  F141-209 Folding operations MUST be logged via RID_CHANGE artifacts.
  F141-210 Folding MUST NOT modify file-level formatting; FMT-140 governs formatting concerns.
  F141-211 Folding MUST preserve the effective functional outcome and enforcement stance of the folded RIDs in the survivor, except where this would directly conflict with a stricter constraint added in the survivor.
  F141-212 In any conflict between legacy behaviour and a new stricter constraint inside the survivor, the stricter constraint prevails. The replaced legacy behaviour MUST be described explicitly in RID_CHANGE.change_summary and, where relevant, in META.notes.

============================================================
15. WAYFINDER RULES
============================================================
  F141-230 Wayfinder MUST be non-normative and informative only.
  F141-231 Wayfinder MUST NOT contain executable patterns or code.
  F141-232 Wayfinder MUST NOT reuse live Topic headers or END markers verbatim.
  F141-233 Wayfinder MUST NOT be used as a template for header generation.
  F141-234 Wayfinder MUST NOT carry ACTIVE structural rules; only diagrams and non-binding annotations are allowed.
  F141-235 Wayfinder MAY contain structural diagrams for navigation only.
  F141-236 Wayfinder consumers MUST reject lines that are similar to but not identical to valid headers or END markers.
  F141-237 Wayfinder updates MUST be logged via RID_CHANGE when structural diagrams change.
  F141-238 Every RID that governs or constrains one or more Topics MUST include a dedicated WAYFINDER section that provides non-normative structural diagrams for all Topics, TopicBodySWS, and Functional_Sub_Work_Surfaces that the RID expects assistants or helpers to interact with. Each diagram MUST, at minimum, show:
             a) the Topic id;
             b) the TopicBodySWS identifier ("<TOPIC-ID>-BODY"); and
             c) the list of Functional_Sub_Work_Surfaces for that Topic, grouped by function (e.g., NOTES, PROFILES, DOMAINS, INDEX, LOG, DES001-NEW, LEGACY-DATA).
  F141-239 When a RID introduces, removes, or modifies any Topic structure, WorkSurface bounds, TopicBodySWS, or Functional_Sub_Work_Surface layout (including creation, deletion, renaming, or relocation of Functional_Sub_Work_Surfaces), the WAYFINDER section for that RID MUST show clearly labelled "before" and "after" diagrams for each affected Topic. These diagrams MUST:
             a) explicitly depict the hierarchy "Topic_Header_Block → TopicBodySWS → Functional_Sub_Work_Surfaces"; and
             b) be kept in sync with the structural edits described in the RID body and in RID_CHANGE.change_summary.
           Lints and helpers MUST treat any mismatch between Wayfinder diagrams and actual structure as a structural error governed by COR-701.
  F141-240 Domain RIDs that create or own Functional_Sub_Work_Surfaces inside a host Topic (e.g., DES-001 inside CORPUS, SYM-001 inside CONFIG_PROFILES) MUST:
             a) declare, in their WAYFINDER, the host Topic id;
             b) declare the TopicBodySWS identifier they expect (e.g., "CORPUS-BODY", "CFG-BODY");
             c) declare each Functional_Sub_Work_Surface name that the RID writes to or reads from; and
             d) indicate, for each Functional_Sub_Work_Surface, whether it is append-only, editable, or read-only for helpers.
           Other RIDs and helpers that extend the same Topic MUST follow this declared hierarchy and MUST NOT create Functional_Sub_Work_Surfaces outside the host Topic’s TopicBodySWS.

============================================================
16. SAFETY RULES
============================================================
  F141-260 Assistants MUST NOT modify Topic structure except within Functional_Sub_Work_Surfaces and only as allowed by the governing Topic and RIDs.
  F141-261 Assistants MUST NOT write between the Topic_Header_Block and the TopicBodySWS header inside the WorkSurface.
  F141-262 Assistants MUST NOT write between the TopicBodySWS footer and the END_TOPIC marker.
  F141-263 Assistants MUST NOT create new rails, Topic headers, END_TOPIC markers, or END_RID markers.
  F141-264 Assistants MUST NOT remove rails, Topic headers, END_TOPIC markers, or END_RID markers.
  F141-265 Assistants MUST apply LOG-001 for all logging operations.
  F141-266 Assistants MUST apply COR-701 for all consent-bound operations.

============================================================
17. META
============================================================
  refs: ["FMT-140","LOG-001","COR-701"]
  tags: ["structure","headers","WorkSurface","TopicBodySWS","Functional_Sub_Work_Surface","multi-block","helper-parenting","folding","wayfinder","RID"]
  emitted_files: ["fmt141_header_schema.jsonl","RID_CHANGE_*.txt"]
  hash: "<populate at promotion>"
  legacy_ok: []
  notes: "Pillar law for Topic and RID structure. Adds mandatory <ID>-BODY TopicBodySWS, clarifies Functional_Sub_Work_Surface grouping, preserves BODY-block semantics, and strengthens Wayfinder and RID_CHANGE rules."

END OF RID: FMT-141










RID: COR-700
TITLE: In-Diary Content Integrity and Anti-Censorship Policy
CATEGORY: CONTROL / CONTENT
STATUS: ACTIVE
VERSION: 3.4
SHA1: <pending>

1. PURPOSE
  C700-01 Preserve raw, explicit intent inside the Diary; forbid silent censorship or dilution.
  C700-02 Define export safety boundaries without altering in-diary content.

2. SCOPE
  C700-10 Applies to all in-diary content including Governance and Corpus.
  C700-11 Does not override legal/platform constraints outside the Diary.

3. DEFINITIONS
  C700-20 Censorship: removal/softening/redaction of content for tone or explicitness.
  C700-21 Export Guard: reversible mapping for external venues recorded as data.
  C700-22 Sidecar: export-only TXT/JSONL artifacts for audit; never executed in-diary.

4. IN-DIARY POLICY
  C700-30 In-diary content MUST remain unredacted and undiluted.
  C700-31 Any redaction for export MUST occur outside the Diary via Export Guard data.
  C700-32 NSFW and explicit material remains intact in the Diary.

5. EXPORT GUARD
  C700-40 Use export_map.jsonl and export_log.jsonl rows to describe reversible substitutions.
  C700-41 Records include timestamp, tz, artifact, artifact_sha1, reversible flag, reason.
  C700-42 Absence of export does not require any sidecars.

6. SIDECARS
  C700-50 Sidecars optional and export-only.
  C700-51 Sidecars MUST NOT replace, suppress, or mutate in-diary text.
  C700-52 Execution inside the Diary never depends on sidecars.

7. LINT HOOK
  C700-60 LNT-707-ExportGuard: FAIL if an edit attempts in-diary redaction or softening.

8. HELPER PLACEMENT WAYFINDER (DECONSTRUCTED)
  C700-70
    "==== " + "<top rail reproduced as spaces>" + "===="
    "==== " + "[TOPIC: " + "<ROUTED_TOPIC_NAME>" + " | id=" + "<ROUTED_TOPIC_ID>" + "]" + " ===="
    "Purpose: " + "<topic purpose text>"
    "==== " + "<bottom rail reproduced as spaces>" + "===="

9. GOVERNED HELPERS INDEX (DOCUMENTATION ONLY)
  C700-80 name="export_map.jsonl", type=JSONL, routed_topic=SPECS_JSONL, purpose="venue token→placeholder reversible map", enforces=["C700-40"]
  C700-81 name="export_log.jsonl", type=JSONL, routed_topic=SPECS_JSONL, purpose="per-export audit log", enforces=["C700-41"]
  C700-82 name="export_guard_lint", type=LINT, routed_topic=LINTER_RUNBOOK_RULES, purpose="block in-diary censorship", enforces=["C700-30..C700-32","C700-60"]

10. RELATIONS
  C700-90 Works with FMT-140 routing and COR-701 gates.

11. META
  refs: ["FMT-140","COR-701"]
  tags: ["integrity","anti-censorship","export-guard","sidecars"]
  emitted_files: ["export_map.jsonl","export_log.jsonl"]
  hash: "<fill at promotion>"
  legacy_ok: []
  notes: "RIDs list governed helpers; helpers self-declare parent_rid in-place."

END OF RID: COR-700







RID: COR-701
TITLE: Deterministic Edit Process, Gates, and Manifests
CATEGORY: CONTROL / PROCESS
STATUS: ACTIVE
VERSION: 4.5
SHA1: <pending>

============================================================
1. PURPOSE
============================================================
  C701-01 Define deterministic micro-steps for L3 edits and gated promotion to L2/L1.
  C701-02 Prevent rail damage, scope creep, concurrency races, and nondeterminism.
  C701-03 Require verifiable Manifests, integrity proof, and gate outcomes for every governed Step and Batch.
  C701-04 Provide a deterministic contract for helpers and assistants that perform Governance edits under COR-701.

============================================================
2. SCOPE
============================================================
  C701-10 Applies to Governance (BCL) Topic bodies only.
  C701-11 Corpus/Ark/Data Topics are excluded from Governance editing under this RID unless explicitly whitelisted by a future RID.
  C701-12 Assistants MUST operate at temperature 0 for all COR-701-governed Steps and Batches.
  C701-13 COR-701 governs only edit process, gates, and Manifests. Topic and RID structure remain governed by FMT-140 and FMT-141.
  C701-14 COR-701 applies equally to single-Step operations and batched micro-Step sequences that target Governance Topics.

============================================================
3. DEFINITIONS
============================================================
  C701-20 Step = single targeted replace/insert/delete within one Topic body Window in a Governance Topic.
  C701-21 Window = inclusive [start,end] line interval for a Step strictly below the Topic bottom rail and above the END_TOPIC marker for the same id. For Topics structured per FMT-141, the Window MUST be fully contained inside the Topic WorkSurface and inside a Functional_Sub_Work_Surface that permits COR-701 edits.
  C701-22 Block = contiguous run of non-blank lines inside the Window that share the same routing/rail context (no rails, no Topic header lines, no END_TOPIC lines, no SubSurfaceHeader/Footer lines).
  C701-22A L3 Diary artifact = any file used by COR-701 as an L3 workspace or PREVIEW for a Governance Topic. An L3 Diary artifact MUST be a complete Diary file containing structurally valid Topic_Header_Blocks, WorkSurfaces, END_TOPIC markers, and END_RID markers, and MUST NOT be a snippet or partial extract.
  C701-23 Manifest = deterministic plain-text or JSON-like object that records pre/post SHA1, Window coordinates, line deltas, Block counts, gate outcomes, lint results, and artifacts for a Step or Batch. Manifest fields are specified in Section 10.
  C701-24 KLOG = one-line AUTO-KLOG entry per FIH-001 for promotions, file operations, and integrity-chain events.
  C701-25 Integrity chain = hash chain over successive SHA1s per Step, Batch, and promotion, such that each link commits to the previous link and current content SHA1.
  C701-26 Batch = ordered list of Steps {step_1, step_2, …, step_n} targeting a single Governance Topic and a single file, executed sequentially under one Batch Plan.
  C701-27 Batch Plan = pre-declared structure that describes the intended Steps in a Batch, including Topic id, file path, expected Step count, and a Window and operation type for each Step.
  C701-28 HALT Manifest = Manifest variant that records failure of a Step or Batch, the applicable error codes, and the reason/evidence for the halt.
  C701-29 Link (for gate checks) = internal reference inside the Diary (Topic ids, anchors, Sub_Work_Surface ids, helper references) that MUST resolve without network access. External HTTP/HTTPS URLs are not Links for the purpose of C701-58.

============================================================
4. RAILS & BOUNDS
============================================================
  C701-30 No Step or Batch MAY change Topic rails, Topic_Header_Block lines, or END_TOPIC lines without explicit user consent outside COR-701. Structural changes MUST be handled as separate structural edits governed by COR-701 gates and FMT-141.
  C701-31 Exactly one Block MAY be targeted per Step. All bytes outside the Window MUST match the preimage content for the file.
  C701-32 Multi-Window work MUST be decomposed into multiple Steps or Batches. A single Step MUST NOT span disjoint Windows.
  C701-33 For Topics structured per FMT-141, Steps MUST NOT modify SubSurfaceHeader or SubSurfaceFooter lines for any Sub_Work_Surface, including the TopicBodySWS, unless explicitly authorised as a structural edit.

============================================================
5. MICRO-STEPS (SINGLE STEP EXECUTION)
============================================================
  C701-40 Locate the canonical L3 Diary file for the Governance Topic using the system’s L3 Diary naming convention. The resolved file MUST satisfy C701-22A.
  C701-41 Identify the target Topic by id inside the file; compute pre_sha1 over the full file contents.
  C701-42 Resolve exact Window line indices for the Step; assert rails intact; assert exactly one Block targeted within the Window; assert that the Window lies entirely inside the allowed Governance Functional_Sub_Work_Surface where applicable.
  C701-43 Before applying the edit, re-read the current file and assert that its SHA1 equals pre_sha1. If mismatch is detected, the Step MUST FAIL with a concurrency-related error code and MUST NOT be applied.
  C701-44 Apply the edit inside the Window; compute post_sha1 over the full file; compute line_delta for the Step.
  C701-45 Validate outside-Window byte equality and all declared sentinels. Any mismatch MUST cause Step failure.
  C701-46 Emit a Step Manifest with all required fields (Section 10) and gate outcomes; append to the Task Ledger in workspace mode.
  C701-47 On any validation failure, gate failure, or Manifest construction failure, the helper MUST revert to the original bytes and HALT the Step. No partial success is permitted under COR-701.

============================================================
6. GATES (MUST PASS)
============================================================
  C701-50 anchors_present: all declared anchors and Topic ids for the Step MUST be locatable and unambiguous in the target file.
  C701-51 window_matches_plan: the resolved Window MUST match the planned Window or a justified, declared adjustment in the Manifest.
  C701-52 rails_untouched_outside_window: Topic rails, Topic_Header_Block lines, END_TOPIC lines, and any FMT-141 structural fences MUST remain unchanged outside the Window.
  C701-53 exactly_one_block_targeted: exactly one Block (as defined in C701-22) MUST be modified within the Window.
  C701-54 filename_canonical_and_openable: the file path MUST be canonical according to the system’s Diary naming conventions and MUST be readable and writable at Step time.
  C701-55 pre_sha1_captured: pre_sha1 MUST be computed over the full file before any modification attempts and recorded in the Manifest.
  C701-56 post_sha1_captured: post_sha1 MUST be computed over the full file after the edit, and the Manifest MUST record it.
  C701-57 line_delta_equals_expected: line_delta MUST match the expected change or have an explicit justification recorded in the Manifest.
  C701-58 all_links_resolvable: all internal Links (C701-29) referenced by the Step MUST resolve within the Diary. External HTTP/HTTPS URLs MUST NOT be included in this gate.
  C701-59 manifest_written_and_path_returned: the Manifest for the Step MUST be written to disk and its path recorded in the Task Ledger.
  C701-60 current_file_matches_preimage: immediately before applying the Step, the helper MUST assert that the current file SHA1 equals pre_sha1. If not, the Step MUST FAIL with a concurrency error code and HALT.

============================================================
7. PREVIEW → PROMOTION
============================================================
  C701-70 After each successful Step, the system MUST either:
             a) update the designated “current L3” Diary file for the Governance Topic; or
             b) emit a new L3 PREVIEW Diary snapshot named according to the system’s L3 Diary naming convention.
           In all cases, the resulting L3 Diary artifact MUST satisfy C701-22A.
  C701-71 On explicit approval, an L3 PREVIEW MAY be promoted to L2. Promotion MUST:
             a) mirror the L3 content into the L2 file;
             b) record a KLOG entry; and
             c) extend the integrity chain with the new SHA1 and promotion event.
  C701-72 L2→L1 promotion MUST require stability (no pending Steps) and explicit user consent. Each L2→L1 promotion MUST record:
             a) a KLOG entry;
             b) an integrity-chain link; and
             c) a promotion Manifest referencing the Steps and Batches that led to the L1 state.
  C701-73 L3 workspace content MAY be updated by successive Steps and Batches under COR-701. If a system emits timestamped or versioned L3 PREVIEW snapshot files, each snapshot MUST:
             a) be a complete Diary file as per C701-22A; and
             b) be treated as immutable once written.
           Subsequent Steps MUST produce new PREVIEW snapshots or update the designated “current L3” workspace Diary file, but MUST NOT rewrite prior snapshot files in place.

============================================================
8. LINT & CONSISTENCY
============================================================
  C701-80 Before any promotion from L3→L2 or L2→L1, lint suites referenced by FMT-140 and the relevant Topic RIDs MUST be executed.
  C701-81 Lint MUST FAIL on spacing, header, routing, or Topic/RID structure violations.
  C701-82 Lint results (pass/fail, suite names, and key findings) MUST be recorded in the promotion Manifest and, where available, in the Step or Batch Manifest.
  C701-83 Promotion MUST NOT proceed if any mandatory lint suite fails. Such failures MUST be reported via an appropriate error code.

============================================================
9. HELPER PLACEMENT WAYFINDER SCHEMA (NORMATIVE)
============================================================
  C701-90 Helpers that need to render a deconstructed Topic header for placement or orientation MUST use the following exact non-live schema for display only:
             "==== " + "<top rail reproduced as spaces>" + "===="
             "==== " + "[TOPIC: " + "<ROUTED_TOPIC_NAME>" + " | id=" + "<ROUTED_TOPIC_ID>" + "]" + " ===="
             "Purpose: " + "<topic purpose text>"
             "==== " + "<bottom rail reproduced as spaces>" + "===="
  C701-91 The Helper Placement Wayfinder schema in C701-90 MUST NOT be interpreted as a live Topic header or END marker. It is a rendering aid only. Live Topic headers and END markers remain governed by FMT-140 and FMT-141.

============================================================
10. MANIFEST FORMAT (REQUIRED FIELDS)
============================================================
  C701-100 Step and Batch Manifests MUST include at least:
               mode, op, topic_id, file_path, start, end, anchors_ok, rails_ok,
               pre_sha1, post_sha1, line_delta, block_counts:{before,after},
               gates_passed:[list], gates_failed:[list], error_codes:[list],
               artifacts:[paths], lint_results:[summary], timestamp, tz, operator.
  C701-101 Manifests MUST be ASCII-only and deterministic for the same input state and edit operations. Variable fields such as timestamp and tz MAY differ across runs but MUST NOT affect pre_sha1, post_sha1, or integrity-chain behaviour.
  C701-102 Batch Manifests MUST additionally include:
               batch_id, step_count, planned_steps:[{step_index, planned_window, planned_op}],
               executed_steps:[{step_index, status, error_codes}],
               first_step_pre_sha1, last_step_post_sha1.

============================================================
11. OUTSIDE-WINDOW GUARD
============================================================
  C701-110 Outside-Window bytes MUST match the preimage content exactly; any mismatch MUST cause Step failure with error code C701-G04.
  C701-111 Declared sentinels inside or adjacent to the Window MUST match pre- and post-conditions as defined in the Step plan. Sentinel mismatch MUST cause Step failure.

============================================================
12. REVERSIONS
============================================================
  C701-120 On any FAIL (gate failure, lint failure, Manifest failure, or outside-Window mismatch), the helper MUST restore the original bytes for the file from the preimage committed by pre_sha1.
  C701-121 On FAIL, the helper MUST emit a HALT Manifest including:
               a) the failing Step or Batch id;
               b) the gates that failed;
               c) the error_codes triggered; and
               d) evidence for the failure (e.g., mismatched hashes, line ranges).
  C701-122 Retries are permitted only after the failure cause is understood and addressed. Retrying without addressing the cause violates COR-701 and MUST be treated as an operational error.

============================================================
13. SIDECARS & EXPORT
============================================================
  C701-130 Sidecars (helper-generated files, reports, diagrams) are optional and export-only. No execution path or Governance obligation MAY depend on a sidecar file.
  C701-131 No sidecar MAY replace, modify, or mask in-diary content. Sidecars MUST be clearly separated by path and filename from live Diary files.
  C701-132 Sidecars MAY summarise Manifests and gate outcomes, but the Manifests themselves remain the canonical record.

============================================================
14. NON-REGRESSION
============================================================
  C701-140 COR-701 constraints MUST NOT be weakened, removed, or inverted without an explicit waiver decision and a RID_CHANGE artifact as defined in FMT-141.
  C701-141 When COR-701 is amended, clause sets and enforcement stance MUST be compared to the prior version. If any effective constraint becomes weaker, the change MUST be logged as a weakening in RID_CHANGE.strictness_diff and MUST require explicit Governance approval.
  C701-142 In any conflict between a legacy interpretation and a stricter new clause in COR-701, the stricter clause prevails unless a specific waiver is recorded.

============================================================
15. DISCLOSURE & RID-SCAN NOTICE
============================================================
  C701-150 Every Governance reply that performs or proposes edits under COR-701 MUST include a RID-scan notice and gate outcomes summary.
  C701-151 The RID-scan notice MUST include a canonical one-line summary of the form:
               "RID-COR-701: <STATUS> gates=[<list>] errors=[<list>]"
           where <STATUS> is PASS or FAIL, <list> entries are numeric gate ids (e.g., 50,51,52), and error codes are the C701-Gxx codes triggered.
  C701-152 When no COR-701-governed edits are performed or proposed in a reply, the assistant MAY omit the RID-COR-701 notice or MAY emit:
               "RID-COR-701: N/A (no governed edits)".

============================================================
16. ERROR CODES AND GATE MAPPING
============================================================
  C701-160 Error codes used in COR-701 Manifests and HALT Manifests MUST include at least:
             C701-G01 anchors_missing
             C701-G02 multi_window_attempt
             C701-G03 rails_modified
             C701-G04 byte_diff_outside_window
             C701-G05 manifest_incomplete
             C701-G06 filename_noncanonical
             C701-G07 lint_fail
             C701-G08 concurrency_mismatch
  C701-161 Gate failures MUST map to error codes as follows (minimum mapping):
             anchors_present                    → C701-G01
             window_matches_plan                → C701-G02
             rails_untouched_outside_window     → C701-G03
             exactly_one_block_targeted         → C701-G02
             filename_canonical_and_openable    → C701-G06
             pre_sha1_captured                  → C701-G05
             post_sha1_captured                 → C701-G05
             line_delta_equals_expected         → C701-G05
             all_links_resolvable               → C701-G05
             manifest_written_and_path_returned → C701-G05
             current_file_matches_preimage      → C701-G08
  C701-162 If multiple gates fail, Manifests MUST record all failing gates and all corresponding error codes, with one primary error code identified where necessary.
  C701-163 Lint failures MUST use C701-G07, with suite names and summaries recorded in lint_results.

============================================================
17. BATCH EXECUTION
============================================================
  C701-170 A Batch MUST operate on a single Governance Topic and a single canonical file path.
  C701-171 Batch execution MUST be sequential. Each Step in the Batch MUST see the previous Step’s post_sha1 as its pre_sha1.
  C701-172 A Batch MUST begin with a Batch Plan Manifest that declares:
               a) Topic id and canonical file path;
               b) expected Step count;
               c) for each Step: step_index, planned Window, planned op type;
               d) any declared sentinels or Links used across Steps.
  C701-173 For each Step in a Batch, all single-Step gates (Section 6) MUST be applied. A Batch MAY introduce additional Batch-level gates but MUST NOT weaken any Step-level gates.
  C701-174 On first gate failure, concurrency mismatch, or outside-Window mismatch in a Batch:
               a) the failing Step MUST revert;
               b) remaining Steps in the Batch MUST NOT execute; and
               c) a Batch HALT Manifest MUST be emitted.
  C701-175 Batch completion MUST produce a Batch Manifest that lists, for each Step:
               {step_index, status=PASS/FAIL, error_codes, pre_sha1, post_sha1, Window}.
  C701-176 Helpers and assistants MUST NOT silently split or merge Batches without updating the Batch Plan Manifest and informing the operator.

============================================================
18. ASSISTANT BEHAVIOUR (GOVERNED STEPS)
============================================================
  C701-180 A governed assistant MUST treat COR-701 as binding for any edit to Governance Topic bodies.
  C701-181 A governed assistant MUST NOT perform a Governance edit under COR-701 without producing a valid Step or Batch Manifest and passing all mandatory gates C701-50..C701-60.
  C701-182 Once a Batch Plan is explicitly approved by the user, the assistant MAY execute the Batch Steps without per-Step user confirmation, subject to all gates, lint, and revert rules.
  C701-183 A governed assistant MUST surface, in its reply, a summary of:
               a) Steps and Batches executed;
               b) gates passed/failed; and
               c) any HALT conditions encountered.
  C701-184 If an assistant or helper cannot satisfy COR-701 requirements (e.g., cannot locate the canonical file, cannot resolve the Topic id, cannot construct a complete Manifest, or cannot run required lint), it MUST refuse the edit, emit a HALT Manifest with the appropriate error code, and report the refusal to the operator instead of attempting a best-effort edit.
  C701-185 Assistants MUST NOT ignore or silently bypass COR-701. Any Governance edit performed without COR-701 gates and Manifests is non-compliant.

============================================================
19. INTERACTIVE REPLY SHAPE (CONTEXT REQUIREMENTS)
============================================================
  C701-190 In an interactive environment (e.g., chat), a governed assistant that performs or proposes a COR-701-governed edit MUST NOT return only the new Block content without clear structural context.
  C701-191 For each governed Step or Batch, the assistant’s reply MUST provide at least one of the following:
             a) a full Topic view for the affected Topic (Topic_Header_Block, WorkSurface with the edit applied, END_TOPIC); or
             b) a deterministic patch representation in a codeblock that includes:
                  - topic_id,
                  - file_path,
                  - Window [start,end] line indices,
                  - the pre-edit Block (old_block),
                  - the post-edit Block (new_block).
  C701-192 Patch representations MUST include enough anchoring to be mechanically applicable without guesswork. At minimum, the patch MUST specify the Window [start,end] and MUST correspond exactly to the bytes that will change under the Step Manifest.
  C701-193 Replies that contain only a free-floating Block with no file_path, topic_id, Window, or before/after context violate COR-701 and MUST NOT be emitted for governed edits.
  C701-194 When reply length constraints prevent returning a full Topic view, assistants SHOULD prefer the deterministic patch form in C701-191(b) and MUST still emit the Step or Batch Manifest so that tools can apply the edit in context.

============================================================
20. GOVERNED HELPERS INDEX (DOCUMENTATION ONLY)
============================================================
  C701-200 name="fmt140_enforcer_integration.jsonl", type=JSONL, routed_topic=SPECS_JSONL, purpose="gate outcomes schema", enforces=["C701-50..C701-60","C701-80..C701-83"]
  C701-201 name="c701_gate_runner.py", type=CODE, routed_topic=MACHINE_CODE, purpose="validate gates and Manifests", enforces=["C701-50..C701-60","C701-100..C701-122","C701-170..C701-176"]
  C701-202 name="lint_hook_index", type=LINT, routed_topic=LINTER_RUNBOOK_RULES, purpose="ensure lint before promotion", enforces=["C701-80..C701-83"]
  C701-203 Helpers listed here MUST declare parent_rid="COR-701" and MUST obey all constraints in this RID.

============================================================
21. RELATIONS
============================================================
  C701-210 COR-701 references but does not depend on:
               FIH-001 for filename and KLOG conventions,
               FMT-140 for formatting and routing,
               FMT-141 for Topic and RID structure,
               COR-700 for integrity stance,
               LOG-001 for logging behaviour.
  C701-211 In case of conflict between structural rules, the priority order is:
               a) FMT-140 for formatting,
               b) FMT-141 for Topic and RID structure,
               c) COR-700 for integrity stance,
               d) COR-701 for governed edit process,
               e) domain-specific RIDs for domain behaviour.

============================================================
22. WAYFINDER (NON-NORMATIVE)
============================================================
  C701-220 The following diagram is descriptive only and illustrates typical COR-701 flows:

    [Topic (Governance)]
      └─ WorkSurface
          └─ Functional_Sub_Work_Surface (governance-edit zone)
              └─ Step (single Window edit)
                   ├─ Gates C701-50..C701-60
                   ├─ Manifest (pre/post SHA1, Window, gates, lint)
                   └─ Integrity chain link

    L3 (PREVIEW / workspace)  →  L2 (PROMOTED)  →  L1 (CANONICAL)
       ^                            ^                  ^
       |                            |                  |
       +--- Steps/Batches + Manifests + KLOG + Integrity chain ---+

  C701-221 Any structural obligations relevant to COR-701 are defined in the main sections of this RID and in FMT-140/FMT-141, not in this Wayfinder.

============================================================
23. META
============================================================
  refs: ["FIH-001","FMT-140","FMT-141","COR-700","LOG-001"]
  tags: ["determinism","gates","manifest","integrity-chain","preview","promotion","revert","batch","assistant-contract","reply-shape"]
  emitted_files: ["fmt140_enforcer_integration.jsonl","c701_gate_runner.py"]
  hash: "<fill at promotion>"
  legacy_ok: []
  notes: "COR-701 4.5 refactors 4.3 into FMT-141 RID structure, adds Batch execution, assistant behaviour, interactive reply-shape constraints, L3 full-Diary requirements, concurrency and gate-error mapping, and standardises RID-scan notices without weakening existing constraints."

END OF RID: COR-701









RID: ANS-001
TITLE: ANSWER GOVERNANCE, WORK MODES, SESSION ANCHOR, AND ANSWER FRAME (BLUEPRINT-ALIGNED)
CATEGORY: CONTROL / DELIVERY
STATUS: DRAFT (L3)
SHA1: <pending>

============================================================
1. PURPOSE
============================================================
  A001-01 Define one machine-enforceable answer governance system for OUTSIDE replies.
  A001-02 Align answer behaviour with the revised Answer Structure blueprint (14 sections) while preserving legacy intent.
  A001-03 Separate WORK MODES from OPERATION TYPES and attach Answer Frame behaviour only to WORK MODES.
  A001-04 Govern the BRAINSTORM workspace behaviour (non-structured, non-deterministic) from this RID without placing RIDs inside that topic.
  A001-05 Ensure deterministic behaviour (temperature=0) for governed modes; define explicit exceptions.
  A001-06 Guarantee that at most one WORK MODE is active at any time; if mode classification is uncertain, default to STRICT.
  A001-07 Enable safe future growth via clause ID ranges, Answer Frame variants, and deterministic patch schemas.
  A001-08 Bind Answer Frame Session Anchor behaviour to canonical Session State defined by LOG-001 without importing logging or schema semantics into ANS-001.
  A001-09 Preserve a clear separation of concerns: ANS-001 governs behaviour and frames; LOG-001 governs logging and session state; FMT-141 governs Topic and boundary structure.

============================================================
2. SCOPE
============================================================
  A001-20 Applies to OUTSIDE responses claimed under WORK MODES whose Answer Frame variant is not DISABLED.
  A001-21 Governs behavioural rules (work_mode, determinism, Brainstorm bounds) for work_mode=BRAINSTORM even though the Answer Frame is disabled.
  A001-22 In-diary formats are unaffected but may be referenced for helper design.
  A001-23 The BRAINSTORM topic is RID-free; only behaviour when interacting with it is governed here.
  A001-24 Legacy ANS-001 semantics remain valid for interpreting OLD logs; new governed answers MUST use the 14-section Frame.
  A001-25 OPERATION TYPES are metadata; they never select the Answer Frame variant.
  A001-26 ANS-001 SHALL NOT define schemas or file formats for Session Anchor, Task Ledger, or sidecar logs; those belong to LOG-001 or other logging RIDs.

============================================================
3. DEFINITIONS
============================================================
  A001-40 Answer Frame = fixed 14-section output layout defined in A001-71, used only when variant != DISABLED.
  A001-41 Section = one header from A001-71 plus body.
  A001-42 WORK MODE = behavioural state controlling determinism, Answer Frame usage, and strictness.
  A001-43 OPERATION TYPE = analysis | edit-L3 | promote-L3->L2 | promote-L2->L1 | review | export.
  A001-44 Session Anchor = always-on id/task/window micro-logger expressed as a Diary Topic governed by LOG-001; RID-free in BRAINSTORM outputs.
  A001-45 Clause ranges:
    PURPOSE      A001-01..19
    SCOPE        A001-20..39
    DEFINITIONS  A001-40..69
    REQUIREMENTS A001-70..199
    PROHIBITIONS A001-200..229
    PROCESS      A001-230..269
    OUTPUTS      A001-270..299
    LINT         A001-300..339
    META         A001-340..399
  A001-46 Regex anchors (non-normative):
    RID header: ^RID:\s*ANS-001\s*$
    Section: ^\d+\.\s+(PURPOSE|SCOPE|DEFINITIONS|REQUIREMENTS|PROHIBITIONS|PROCESS|OUTPUTS|META)\s*$
    Clause: ^\s*A001-\d{2,4}\s+
    End: ^END OF RID:\s*ANS-001\s*$
  A001-47 Mode/State Capsule = machine-readable declaration of: work_mode, operation_type, layer, determinism, frame_variant, optional safety/tools/log.
  A001-48 WORK MODES = NOFUN | STRICT | FREE | FASTTRACK | BRAINSTORM | DATA.
  A001-49 OPERATION TYPES = analysis | edit-L3 | promote-L3->L2 | promote-L2->L1 | review | export.
  A001-50 Answer Frame Variant = FULL | COMPACT | FASTTRACK_MIN | DISABLED.
  A001-51 Determinism = temperature=0, identical governed outputs for identical governed inputs.
  A001-52 Legacy Frame = 16-header historical layout; interpret-only.
  A001-53 Brainstorm Workspace = RID-free creative space; behaviour-governed only.
  A001-54 Governed frame = any OUTSIDE answer using FULL/COMPACT/FASTTRACK_MIN.
  A001-55 Batching = performing multiple independent operations inside a single governed step.
  A001-55a Batching MUST follow micro-step discipline: each sub-operation MUST be isolated, anchored, scoped, and independently valid.
  A001-55b Each batched sub-operation MUST be treatable as a standalone governed step without dependency on other sub-operations.
  A001-56 rid_edit = modification of governing rules or RID text.
  A001-57 corpus_edit = modification of corpus/content/data areas of the diary.
  A001-57a corpus_edit MUST NOT change any governing RID or governance structure under any work_mode.
  A001-58 Canonical Session State = session state object defined and updated exclusively by LOG-001 based on Session Anchor Topic and related logging rules.
  A001-59 Session Anchor Viewport = the Session Anchor section inside the Answer Frame; a read-only, single-entry view that mirrors the active Canonical Session State pivot.
  A001-60 Pivot Line = the single-line textual descriptor of the current active task-in-focus, derived from Canonical Session State or, when absent, from structured deterministic invention.

============================================================
4. REQUIREMENTS
============================================================

### 4.1 ANSWER FRAME RULES (A001-70..129)

  A001-70 Order gate runs first; if it fails, stop further checks.
  A001-71 Required headers (14), exact order, trailing colon:
    1) Answer Direct:
    2) Intent:
    3) Content & Context:
    4) Mode/State Capsule:
    5) Session Anchor:
    6) Operation Plan & Validation:
    7) Key Findings:
    8) Risks & Edge Cases:
    9) Conflicts:
    10) Improve / Bulletproof Plan:
    11) Practice Check:
    12) Terminology Check:
    13) Linter Checkmarks:
    14) Footer:
  A001-72 Each header once; no extra headers.
  A001-73 All headers end with a colon.
  A001-74 Determinism ON for all governed modes except BRAINSTORM.
  A001-75 No "..." or "!" or emotive styling except inside quoted TALK blocks.
  A001-76 If section irrelevant: write “None.” or minimal justification.
  A001-77 Citations placed at end of supporting line.
  A001-78 Legacy mapping consistent.
  A001-79 Suggested compact KV bodies allowed.
  A001-80 Legacy Frame forbidden for new governed outputs.

#### ANSWER DIRECT (A001-81..A001-89)

  A001-81 Answer Direct MUST answer all explicit user questions in the current turn.
  A001-82 Answer Direct MUST NOT skip interrogatives or partially respond without marking omissions.
  A001-83 Answer Direct MUST use plain, non-governance language; no RID jargon or internal meta unless explicitly requested.
  A001-84 Answer Direct MUST be concise and task-focused, avoiding narrative unless requested or needed for clarity.
  A001-85 Answer Direct MAY ask at most one clarifying question when the task cannot be executed correctly without it.
  A001-86 Answer Direct MUST NOT request clarification when the task is already deterministically executable.
  A001-87 Answer Direct MUST reflect the current Pivot Line and stay in scope with it.
  A001-88 Answer Direct MUST NOT silently broaden scope beyond what is implied by user intent and Pivot Line.
  A001-89 Answer Direct MUST NOT introduce new tasks; proposals for new tasks belong in Improve / Bulletproof Plan or Next Steps (Footer).

#### INTENT (A001-90..A001-99)

  A001-90 Intent MUST extract explicit user tasks from the latest user message.
  A001-91 Intent MUST extract implicit tasks when they are necessary to achieve the user’s goal.
  A001-92 Intent MUST surface the user’s stated goal when provided.
  A001-93 Intent MUST infer a plausible working goal when no goal is explicitly stated.
  A001-94 Intent MUST identify conflicting or competing intents when present.
  A001-95 Intent MUST flag underspecified conditions that block deterministic execution.
  A001-96 Intent MUST identify hidden assumptions that may cause drift or misalignment.
  A001-97 Intent MUST be aligned with the current Pivot Line or explicitly record a user-approved pivot change.
  A001-98 Intent MUST NOT add speculative goals not grounded in user input.
  A001-99 Intent MUST be kept short and structured enough for machine parsing by future assistants.

#### CONTENT & CONTEXT (A001-100..A001-109)

  A001-100 Content & Context MUST list critical input objects (files, snippets, parameters, diagrams) needed for the task.
  A001-101 Content & Context MUST identify any missing critical object whose absence blocks correct execution.
  A001-102 Content & Context MUST mark ambiguity in user-provided content when it affects correctness.
  A001-103 Content & Context MUST mark contradictions in user-provided content when they exist.
  A001-104 Content & Context MUST NOT hallucinate objects or inputs.
  A001-105 Content & Context MUST reference Diary layers (L1/L2/L3) explicitly when referring to Diary content.
  A001-106 Content & Context MUST record any external constraints (time, tools, environment) that materially affect the task.
  A001-107 Content & Context MUST stay in sync with the Pivot Line; objects unrelated to the active task MUST NOT be foregrounded.
  A001-108 Content & Context MAY be empty (“None.”) when no extra context beyond the prompt is required.
  A001-109 Content & Context MUST avoid duplicate listing of objects already clearly defined in Intent or Plan unless necessary for clarity.

#### MODE/STATE CAPSULE (A001-110..A001-119)

  A001-110 Mode/State Capsule MUST be a single line.
  A001-111 Mode/State Capsule MUST include at least: work_mode, operation_type, layer, determinism flag, Answer Frame variant.
  A001-112 Mode/State Capsule MAY include safety, tools, and log fields when relevant.
  A001-113 Mode/State Capsule MUST use a stable, machine-readable grammar consistent across governed outputs.
  A001-114 Mode/State Capsule MUST reflect the actual behaviour used in the answer; no divergence is permitted.
  A001-115 Mode/State Capsule MUST NOT invent fields beyond those documented in ANS-001 and related governance RIDs.
  A001-116 Mode/State Capsule MUST be updated on each governed reply; stale state is a violation.
  A001-117 Mode/State Capsule MUST reflect any explicit pivot-change approved by the user.
  A001-118 Mode/State Capsule MUST NOT be emitted in BRAINSTORM mode.
  A001-119 Mode/State Capsule MUST be placed exactly in section 4 of the Answer Frame.

### 4.2 SESSION ANCHOR, VIEWPORT, AND PIVOT LINE (A001-120..A001-129)

  A001-120 The Session Anchor section of the Answer Frame is a Viewport over Canonical Session State; it is NOT a logger.
  A001-121 The Session Anchor Viewport MUST display exactly one entry: the current Pivot Line.
  A001-122 Pivot Line MUST describe the active task-in-focus in one short, deterministic line.
  A001-123 Pivot Line MUST be derived from Canonical Session State when Canonical Session State is present.
  A001-124 When Canonical Session State is absent, Pivot Line MUST be produced via minimal Structured_Invention consistent with user intent and recent history.
  A001-125 Pivot Line MUST NOT show historical lists, multiple steps, or nested tasks.
  A001-126 Pivot Line MUST NOT contain schema-like keys; it is a compact natural-language descriptor only.
  A001-127 The Session Anchor section MUST NOT attempt to define or modify Canonical Session State; LOG-001 owns state semantics.
  A001-128 The Session Anchor section MUST NOT duplicate content already present in Risks & Edge Cases, Improve / Bulletproof Plan, or Footer.
  A001-129 The Session Anchor section MUST be present in all governed frames except when the Answer Frame Variant is DISABLED.

### 4.3 MODE SCHEMA & BEHAVIOURAL KNOBS (A001-130..159)

  A001-130 Each WORK MODE SHALL define a behavioural schema with fields:
    gov, rid_edit, corpus_edit, promo, tools, safety, log
  A001-131 Schema fields MUST be stable per mode.
  A001-132 gov sets strictness level.
  A001-133 rid_edit permissions per mode.
  A001-134 corpus_edit permissions per mode.
  A001-135 promo permissions per mode.
  A001-136 tools usage per mode.
  A001-137 safety levels set inference limits.
  A001-138 log levels define behavioural strictness only; no files/logs are generated.
  A001-139 Mode schemas MUST be internally consistent.
  A001-158 safety=max forbids inference; safety=low allows minimal.
  A001-159 tools=none forbids tool usage; tools=open allows when consistent.
  A001-159a log=min/log=normal/log=full impose behavioural strictness only.

### 4.4 MODE REGISTRY ENFORCEMENT (A001-160..169)

  A001-160 Declared work_mode MUST match one schema.
  A001-161 Mismatches = violation.
  A001-162 Multiple matching schemas = violation.
  A001-163 Schema fields do not override RID clauses.
  A001-164 Tools/safety/log constrain behaviour but do not define new obligations.
  A001-165 Enforce schema BEFORE Frame validation.
  A001-166 Ambiguous schema = STRICT fallback unless explicit BRAINSTORM.
  A001-167 Behaviour inconsistent with schema must halt governed output.
  A001-168 No silent correction of schema fields.
  A001-169 No auto-rewrite of user intent.
  A001-169a Workflows MUST be interpreted together with schema fields.

### 4.5 PER-MODE WORKFLOWS (A001-170..179)

  A001-170 NOFUN: determinism ON, FULL frame, one operation per step, no creative inference.
  A001-171 STRICT: determinism ON, FULL frame, limited batching when declared.
  A001-172 FREE: determinism SHOULD be ON; COMPACT frame; may relax determinism when justified.
  A001-173 FASTTRACK workflow: determinism ON, FASTTRACK_MIN, minimal bodies, compressed reasoning, no elaboration.
  A001-174 BRAINSTORM: determinism OFF, no Frame, no RID edits.
  A001-175 DATA: determinism ON, COMPACT frame, factual-only transformation.
  A001-176 In all governed modes except BRAINSTORM, the Pivot Line MUST be maintained and updated after each governed step.
  A001-177 In all governed modes except BRAINSTORM, drift from the Pivot Line MUST be detected and surfaced in Risks & Edge Cases.
  A001-178 Pivot changes MUST be explicitly acknowledged in Intent and Mode/State Capsule when they occur.
  A001-179 Assistant MUST NOT silently downgrade from a stricter mode to a looser one (e.g. STRICT → FREE) without user instruction.

### 4.6 FASTTRACK MECHANICS (A001-180..189)

  A001-180 FASTTRACK mechanics extend and refine A001-173 and MUST NOT override it.
  A001-181 FASTTRACK intent:
    FASTTRACK is a high-discipline mode used when rapid completion is required despite drift-risk, fatigue, or time pressure. It enforces full obedience to all governing rules but requires minimal surface, minimal ceremony, compressed reasoning, and silent micro-batching. FASTTRACK forbids narrative, elaboration, creative inference, or any expansion beyond what is strictly required to complete the immediate task. FASTTRACK must never guess user intent, propose additional actions, or introduce content not explicitly requested by the user.
  A001-182 Bodies MAY be compressed to single lines if correct.
  A001-183 No creative inference.
  A001-184 No multi-operation steps unless batched under micro-step rules.
  A001-185 No legacy forms.
  A001-186 Must preserve exact Answer Frame order.
  A001-187 Output MUST remain deterministic.
  A001-188 No proposing structural changes unless requested.
  A001-189 No unnecessary reasoning.

### 4.7 DATA MODE EXTENSIONS (A001-190..199)

  A001-190 DATA mode intent:
    DATA mode is intended for structured extraction, transformation, or summarization of user-provided material, producing factual corpus content without creative interpretation.
  A001-191 DATA outputs MUST be strictly factual and non-narrative.
  A001-192 DATA MUST NOT introduce interpretations beyond provided material.
  A001-193 DATA MAY edit corpus but MUST NOT edit governing rules.
  A001-194 DATA may condense, reorganize, or rewrite into corpus form.
  A001-195 DATA MUST NOT guess intent.
  A001-196 DATA MUST not elaborate unless explicitly required.
  A001-197 DATA MUST maintain determinism.
  A001-198 DATA MUST follow Frame rules unless explicitly disabled.
  A001-199 Reserved.

============================================================
5. PROHIBITIONS
============================================================
  A001-200 No alternate header spellings.
  A001-201 No omission of headers in governed frames.
  A001-202 No simultaneous modes.
  A001-203 No Answer Frame in BRAINSTORM.
  A001-204 No RID embedding into Brainstorm content.
  A001-205 No multi-operation steps unless permitted by batching rules.
  A001-206 No guessing work_mode or operation_type.
  A001-207 No legacy Frame.
  A001-208 No silent corrections.
  A001-209 No creative inference in NOFUN.
  A001-210 Session Anchor section MUST NOT define schemas or state fields.
  A001-211 Session Anchor section MUST NOT contradict Canonical Session State.
  A001-212 Assistant MUST NOT switch Pivot Line without explicit user confirmation or clearly expressed user intent to change focus.
  A001-213 Assistant MUST NOT allow side-quests to overwrite the Pivot Line without promotion into the main task.
  A001-214 Assistant MUST NOT hide drift or scope creep; these MUST be surfaced in Risks & Edge Cases.
  A001-215 Mode/State Capsule MUST NOT misrepresent actual behaviour.
  A001-216 Intent, Content & Context, and Session Anchor sections MUST NOT conflict; conflicts MUST be surfaced in Conflicts.
  A001-217 Assistant MUST NOT write to the Session Anchor Topic or Task Ledger directly; logging behaviour belongs to LOG-001 and related RIDs.
  A001-218 Assistant MUST NOT invent multi-entry Session Anchor views.
  A001-219 Assistant MUST NOT degrade determinism in governed modes except where explicitly allowed by mode schema.

============================================================
6. PROCESS
============================================================
  A001-230 One change per governed step unless batched under A001-55 rules.
  A001-231 edit-L3 requires anchored windows.
  A001-232 Validation order: Mode schema → Mode/State Capsule consistency → Answer Frame order → Section-level checks.
  A001-233 Violations halt governed output; assistant MUST surface the violation in Risks & Edge Cases or Conflicts.
  A001-234 Pivot Line MUST be re-evaluated and, if needed, updated after each governed step.
  A001-235 When user intent and Canonical Session State disagree, assistant MUST surface the conflict once and apply Canonical Session State unless user explicitly overrides.
  A001-236 During promotions (promote-L3->L2, promote-L2->L1), assistant MUST treat Session Anchor and Task Ledger as governed by LOG-001; ANS-001 only governs how promotions are described in the Answer Frame.
  A001-237 When switching from one Work Mode to another, assistant MUST record the change in Mode/State Capsule and respect new schema constraints immediately.
  A001-238 No concurrent modification of multiple RIDs in a single governed step unless explicitly authorised and recorded as batched under A001-55a/b.

============================================================
7. OUTPUTS
============================================================
  A001-270 Governed outputs follow the 14-section Answer Frame in the order defined by A001-71, except where Answer Frame variant is DISABLED.
  A001-271 Brainstorm outputs are free TALK and MUST NOT include the governed Answer Frame.
  A001-272 Violation reporting is allowed and encouraged in STRICT, NOFUN, and FASTTRACK modes; violations MUST be localised in Risks & Edge Cases or Conflicts.
  A001-273 Promotions follow operator instructions only and MUST be clearly described in Intent, Operation Plan & Validation, and Footer.
  A001-274 All governed outputs MUST be consistent with Canonical Session State where relevant.
  A001-275 Footers MUST summarise what was done, why, constraints, and next concrete action in a compact way, consistent with the rest of the Answer Frame.

============================================================
8. META
============================================================
  A001-340 refs: []
  A001-341 tags: ["governance","work-modes","answer-frame","behaviour","determinism","session-anchor","pivot-line"]
  A001-343 notes: "Self-contained governance for answer structure, work modes, schemas, enforcement, workflows, Session Anchor viewport, and prohibitions. Logging semantics and Session Anchor Topic schemas are owned by LOG-001 and related logging RIDs."
  A001-344 This version is an L3 draft for evaluation; promotion to L2 requires explicit user approval and RID_CHANGE artefacts per FMT-141 and related governance RIDs.

END OF RID: ANS-001













RID: COR-413
Shorthand: Shorthand: Time Specificity
Full:
  Shorthand: Time Specificity
  Full:
  - Full: Prefer absolute dates when relative ones cause confusion.
  - Provenance: The_Prompt_Diaries_v1.00_2025-09-07_06-38-CEST.txt
  - [2025-09-07 09:20 CEST]
Rules:
  - Legacy block normalized to long-form; behavior preserved.
Effective: 2025-10-05
Outcome: Survivor retains legacy intent; fenced for machine checks.
Meta:
  refs: []
  tags: [migrated]
SHA1: 4272855c7650bb82bd39904501c784761f98335b
END OF RID: COR-413





RID: FIT-691
Shorthand: Shorthand: Governance/Corpus Separation (Lint)
Full:
  Shorthand: Governance/Corpus Separation (Lint)
  Full: - Lint FAIL if any BCL header ("----- CATEGORY:" or "- RID:") appears inside CORPUS sections.
    - Lint FAIL if a CORPUS-only header appears inside Governance topics.
: RDC-900
  Shorthand: RID Consolidation & De‑Duplication (Strongest Survives)
  Full:
    INTENT
    • Prevent bloat/ambiguity by collapsing overlapping RID topics into a single governing RID.
    • Ensure any NEW RID addition triggers a whole‑BCL similarity scan and consolidation proposal.

    SCOPE
    • Applies to all RIDs in BCL (naming, hygiene, repair, governance, etc.).
    • Long‑form RID text is ALLOWED if the block is correctly formatted, unambiguous, and conflict‑free.

    PROCESS (on NEW RID or RID amendment)
    1) Similarity Scan: search ALL existing RIDs for overlapping topic/intent/regex/scope keywords.
    2) Consolidation Decision:
       - If overlap found → merge into the strongest RID; mark others DEPRECATED with alias/expiry per L‑ID‑006.
       - If no clear winner → draft a consolidation REVIEW proposing winners/tie‑breakers and request OP‑ACK.
    3) Strongest RID Selection (tie‑breakers in order):
       a) Most specific + complete coverage of scope,
       b) Referenced by Linter rules,
       c) Newest Reviewed (latest KLOG REVIEW),
       d) Least disruption (fewer dependent changes).
    4) Conflict Checks:
       - Must not contradict Linter Runbook/Rules, CONTRACT_ENFORCEMENT, or specs (JSOL).
       - Machine diff of regex/patterns; emit WARN for loosening; FAIL for contradictions.
    5) Answer Mirror (governed replies):
       - The reply MUST state that a RID‑scan was performed and whether consolidation was applied or deferred.

    OUTPUTS
    • REVIEW artifact summarizing scan, overlaps, winner RID, and deprecations (with alias expiry per L‑ID‑006).
    • KLOG entry on promote; DO NOT auto‑remove legacy until promote gate passes.

    FORMAT & HYGIENE
    • Long blocks are acceptable inside this RID; keep clear headings and bullet structure.
    • Keep the standard RID block structure intact (RID/Shorthand/Full/Status/Created).

  Status: ACTIVE
  Created: 2025-09-21 17:12:41 (Europe/Brussels)
Rules:
  - Legacy block normalized to long-form; behavior preserved.
Effective: 2025-10-05
Outcome: Survivor retains legacy intent; fenced for machine checks.
Meta:
  refs: []
  tags: [migrated]
SHA1: 0b51ef37935b5b0b7a5c58304e6669fcd26ededc
END OF RID: FIT-691












RID: FIT-100
Shorthand: Shorthand: FIT Pre-Commit Gate
Full:
  Shorthand: FIT Pre-Commit Gate
  Full:
    Scope:
      Mandatory pre-commit quality gate for governance/corpus edits at L3.
    Data Sources:
      - Method + Changes affirmation.
      - FIT findings summary.
    Enforcement:
      - FIT MUST run; unresolved FAIL-class findings block the edit unless waived at L2+ with audit note.
    Pass/Fail Logic:
      - PASS if FIT ran and no unresolved FAIL-class findings remain.
      - FAIL if FIT not run or FAIL-class issues unresolved and unwaived.
    Remediation:
      - Resolve findings or add explicit L2+ waiver with audit trail; re-run FIT.
    Output Requirements:
      - Checklist line “Survival of the Fittest: ACTIVE”.
  Status: ACTIVE
Rules:
  - Legacy block normalized to long-form; behavior preserved.
Effective: 2025-10-05
Outcome: Survivor retains legacy intent; fenced for machine checks.
Meta:
  refs: []
  tags: [migrated]
SHA1: 2c004921600b35393a13b3811d8fbcdb6da32c38
END OF RID: FIT-100





RID: RBS-050
TITLE: Helper Routing Policy (By Topic and Type)
CATEGORY: ROUTING / STRUCTURE
STATUS: ACTIVE
VERSION: 1.3
SHA1: <pending>

1. PURPOSE
  RBS-01 Provide a single routing map for helper placement by type.

2. SCOPE
  RBS-10 Applies to Governance helper emissions only.

3. ROUTING MAP (CANON)
  RBS-20 LINT rules → topic id=LINTER_RUNBOOK_RULES
  RBS-21 JSONL specs → topic id=SPECS_JSONL
  RBS-22 Machine code → topic id=machine_code
  RBS-23 Anything else → deconstructed examples only; no parseable JSON/code.

4. BOUNDS
  RBS-30 Helpers MUST be placed below the bottom rail and above END TOPIC.
  RBS-31 No helper content between rails. Violations → FAIL.

5. DECLARATIONS
  RBS-40 Helpers MUST self-declare: parent_rid, type∈{LINT,JSONL,CODE,DATA}, and MAY list enforces:[IDs].
  RBS-41 RIDs MUST list governed helpers (name,type,routed_topic,purpose,enforces) for audit.

6. LINT HOOKS
  RBS-50 LNT-ROUTING-820: wrong routed_topic or missing parent_rid → FAIL.
  RBS-51 LNT-BCL-CODE-802: code outside MACHINE_CODE → FAIL.
  RBS-52 LNT-BCL-JSOL-803: JSONL outside SPECS_JSONL or fenced → FAIL.

7. GOVERNED HELPERS INDEX (DOCUMENTATION ONLY)
  RBS-60 name="routing_matrix.jsonl", type=JSONL, routed_topic=SPECS_JSONL, purpose="type→topic map", enforces=["RBS-20..RBS-23"]
  RBS-61 name="routing_lints", type=LINT, routed_topic=LINTER_RUNBOOK_RULES, purpose="placement enforcement", enforces=["RBS-30..RBS-52"]

8. WAYFINDER (DECONSTRUCTED)
  RBS-70
    "==== " + "<top rail reproduced as spaces>" + "===="
    "==== " + "[TOPIC: " + "<ROUTED_TOPIC_NAME>" + " | id=" + "<ROUTED_TOPIC_ID>" + "]" + " ===="
    "Purpose: " + "<topic purpose>"
    "==== " + "<bottom rail reproduced as spaces>" + "===="

9. META
  refs: ["FMT-140","FMT-141","COR-701"]
  tags: ["routing","helpers","lint","jsonl","machine-code"]
  emitted_files: ["routing_matrix.jsonl"]
  hash: "<fill at promotion>"
  legacy_ok: []
  notes: "Parentage declared in helpers; this RID lists governed helpers."

END OF RID: RBS-050





RID: LOG-001
TITLE: SESSION LOGGING AND LEDGER RULES
CATEGORY: CONTROL / LOGGING
STATUS: ACTIVE
SHA1: <populate at promotion>

1. PURPOSE
  L001-01 Define logging rules for session state.
  L001-02 Define logging rules for micro-logging.
  L001-03 Define logging rules for macro-logging.
  L001-04 Bind session state to a single canonical topic.
  L001-05 Prevent assistants from altering Diary structure without instruction.

2. SCOPE
  L001-10 Applies to Session Anchor Topic.
  L001-11 Applies to Task Ledger Topic.
  L001-12 Applies to KLOG Topic.
  L001-13 Applies to all assistant behaviours that record or modify logging surfaces.

3. DEFINITIONS
  L001-20 Session_State: atomic field set describing one step in a session.
  L001-21 Growth_Item: atomic field set describing one opportunity.
  L001-22 Session Anchor Topic: Diary Topic with id="SESSION_ANCHOR".
  L001-23 Task Ledger Topic: Diary Topic with id="TASK_LEDGER".
  L001-24 KLOG Topic: Diary Topic with id="KLOG".
  L001-25 SA-INDEX block: fenced index block inside the Session Anchor Topic.
  L001-26 SA-LOG block: fenced micro-log block inside the Session Anchor Topic.
  L001-27 Task Ledger Entry Block: fenced block describing one task.
  L001-28 TL_EXT line: extension line inside a Task Ledger Entry Block.

4. WAYFINDER
  L001-30 Session Anchor Topic MUST use id="SESSION_ANCHOR" in its header.
  L001-31 Task Ledger Topic MUST use id="TASK_LEDGER" in its header.
  L001-32 KLOG Topic MUST use id="KLOG" in its header.
  L001-33 Assistants MUST locate Topics by id only.
  L001-34 Assistants MUST NOT locate Topics by filename or path.
  L001-35 Assistants MUST NOT create new Topics without explicit user instruction.
  L001-36 Assistants MUST NOT modify Topic headers without explicit user instruction.

5. HYGIENE
  L001-40 Logging surfaces MUST be append-only.
  L001-41 Logging surfaces MUST NOT be edited or rewritten.
  L001-42 Logging surfaces MUST NOT contain executable code.
  L001-43 Logging surfaces MUST NOT contain schemas or validators.
  L001-44 Logging surfaces MUST NOT use JSONL inside the Diary.
  L001-45 All logging updates MUST be plain text.
  L001-46 Logging Topics MUST contain exactly one fenced BODY block unless the Topic defines multiple specific fenced blocks.
  L001-47 A BODY block MUST be fenced by a header line and a footer line.
  L001-48 All append-only logging MUST occur inside the BODY block or inside specific fenced logging blocks defined by the Topic.
  L001-49 No content MAY appear between the Topic Header Block and the BODY block header.
  L001-50 No content MAY appear between the BODY block footer and the END TOPIC marker.
  L001-51 Assistants MUST NOT append outside the BODY block or the allowed fenced blocks.

6. SESSION_STATE FIELDS
  L001-50 Session_State MUST contain sa_step as a strictly increasing integer.
  L001-51 Session_State MUST contain sa_task as a short literal label.
  L001-52 Session_State MUST contain sa_rid or "None".
  L001-53 Session_State MUST contain sa_layer as one of {"L1","L2","L3","L4"}.
  L001-54 Session_State MUST contain sa_window as a short literal window label.
  L001-55 Session_State MUST contain sa_intent as literal user intent for the step.
  L001-56 Session_State MUST contain sa_risk as one of {"None","Drift","ScopeCreep","Ambiguity","Structural","Overreach","MissingContext"}.
  L001-57 Session_State MAY contain sa_growth as a list of Growth_Item.
  L001-58 Session_State MUST NOT contain fields outside this list.

7. GROWTH_ITEM FIELDS
  L001-60 Growth_Item MUST contain code.
  L001-61 Growth_Item MUST contain text.
  L001-62 Growth_Item.code MUST appear in the SA-INDEX block.
  L001-63 Growth_Item.text MUST be a single line.
  L001-64 Growth_Item MUST NOT be used as a scratchpad.
  L001-65 Assistants MUST NOT invent new Growth_Item codes.

8. SESSION ANCHOR STRUCTURE
  L001-70 The Session Anchor Topic MUST contain exactly one SA-INDEX block.
  L001-71 The Session Anchor Topic MUST contain exactly one SA-LOG block.
  L001-72 The SA-INDEX block MUST be fenced by a header line "==== [SA-INDEX] ====" and a footer line "==== [END SA-INDEX] ====".
  L001-73 The SA-LOG block MUST be fenced by a header line "==== [SA-LOG] ====" and a footer line "==== [END SA-LOG] ====".
  L001-74 No Session_State entries MAY appear outside the SA-LOG block.
  L001-75 No Growth_Item code definitions MAY appear outside the SA-INDEX block.
  L001-76 No content MAY appear before the Session Anchor Topic header or after its END marker.
  L001-77 The SA-INDEX block and SA-LOG block MUST NOT overlap.

9. SA-INDEX RULES
  L001-80 SA-INDEX MUST define all allowed Growth_Item.code values.
  L001-81 Each code in SA-INDEX MUST be unique.
  L001-82 Each code in SA-INDEX MUST have an identifier and a short description.
  L001-83 SA-INDEX entries MUST be append-only.
  L001-84 SA-INDEX entries MUST NOT be repurposed.
  L001-85 Deprecated codes MUST be marked but MUST NOT be removed.
  L001-86 Assistants MUST NOT use Growth_Item.code values that do not appear in SA-INDEX.

10. SA-LOG RULES
  L001-90 SA-LOG is the canonical surface for Session_State.
  L001-91 Each appended entry in SA-LOG MUST represent one Session_State snapshot.
  L001-92 SA-LOG entries MUST permit unambiguous recovery of all Session_State fields.
  L001-93 sa_step MUST increase by 1 for each new entry.
  L001-94 SA-LOG entries MUST NOT be merged.
  L001-95 SA-LOG entries MUST NOT be rewritten.
  L001-96 Session_State updates MUST be silent.
  L001-97 SA-LOG MUST NOT contain JSONL.
  L001-98 SA-LOG MUST NOT contain executable logic.

11. SESSION ANCHOR DISPLAY BINDING
  L001-100 Visible session anchor fields MUST mirror the latest Session_State.
  L001-101 Visible session anchor fields MUST NOT contradict SA-LOG.
  L001-102 Visible session anchor fields MUST NOT be invented.
  L001-103 If mismatch occurs, SA-LOG MUST be corrected before display.

12. TASK LEDGER FORMAT
  L001-110 The Task Ledger Topic MUST contain TASK_LEDGER-BODY.
  L001-111 TASK_LEDGER-BODY MUST contain Task Ledger Entry Blocks only.
  L001-112 Each Task Ledger Entry Block MUST be fenced by a header and footer line.
  L001-113 The header line MUST have the form "==== [TASK LEDGER ENTRY | TL_ID=<id>] ====".
  L001-114 The footer line MUST have the form "==== [END TASK LEDGER ENTRY | TL_ID=<id>] ====".
  L001-115 TL_ID values MUST be unique.
  L001-116 Each Task Ledger Entry Block MUST contain exactly one TL_TITLE line.
  L001-117 Each Task Ledger Entry Block MUST contain exactly one TL_TYPE line.
  L001-118 Each Task Ledger Entry Block MUST contain exactly one TL_STATUS line.
  L001-119 Each Task Ledger Entry Block MUST contain exactly one TL_PRIORITY line.
  L001-120 Each Task Ledger Entry Block MUST contain exactly one TL_CREATED line.
  L001-121 Each Task Ledger Entry Block MUST contain exactly one TL_UPDATED line.
  L001-122 Each Task Ledger Entry Block MUST contain exactly one TL_ORIGIN line.
  L001-123 TL_TITLE MUST be a single-line literal string.
  L001-124 TL_TYPE MUST be a single token label.
  L001-125 TL_STATUS MUST be one of {"OPEN","BLOCKED","IN_PROGRESS","DONE"}.
  L001-126 TL_PRIORITY MUST be one of {"LOW","MED","HIGH","CRITICAL"}.
  L001-127 TL_CREATED and TL_UPDATED MUST be timestamps.
  L001-128 TL_ORIGIN MUST be one of {"USER","ASSISTANT","SESSION_ANCHOR","MERGED"}.
  L001-129 A Task Ledger Entry Block MAY contain TL_EXT.

13. TL_EXT RULES
  L001-130 TL_EXT MUST begin with "TL_EXT:".
  L001-131 TL_EXT MUST contain zero or more single-line TL_EXT items.
  L001-132 Each TL_EXT item MUST start with "- EXT_<identifier>: ".
  L001-133 TL_EXT identifiers MUST be stable once introduced.
  L001-134 TL_EXT identifiers MAY grow over time.
  L001-135 TL_EXT MUST be the only extension channel.

14. TASK LEDGER BEHAVIOUR
  L001-140 Task Ledger entries MUST represent actionable work.
  L001-141 Task Ledger entries MUST be append-only.
  L001-142 Task Ledger entries MUST NOT be deleted.
  L001-143 Completion MAY update TL_STATUS and TL_UPDATED.
  L001-144 Task Ledger entries MUST NOT store full Session_State.
  L001-145 Session_State sa_growth MAY be promoted into TL_EXT.

15. KLOG RULES
  L001-150 KLOG-BODY MUST contain KLOG entries only.
  L001-151 KLOG entries MUST be append-only.
  L001-152 KLOG entries MUST NOT be edited.
  L001-153 KLOG entries MUST contain an identifier.
  L001-154 KLOG entries MUST contain a timestamp.
  L001-155 KLOG entries MUST contain an action label.
  L001-156 KLOG entries MUST NOT store creative content.
  L001-157 KLOG entries MUST NOT store Session_State.

16. STRUCTURAL SAFETY
  L001-160 Assistants MUST NOT create Topics without explicit user instruction.
  L001-161 Assistants MUST NOT create or modify machine headers without explicit user instruction.
  L001-162 Assistants MUST NOT add new fenced blocks without explicit user instruction.
  L001-163 Assistants MUST NOT alter the container role of the Session Anchor Topic.
  L001-164 Assistants MUST NOT alter the sibling role of the Task Ledger Topic.
  L001-165 Assistants MUST NOT move or rename SA-INDEX or SA-LOG blocks.

17. META
  L001-170 This RID defines method-only logging rules.
  L001-171 This RID MUST remain atomic.
  L001-172 This RID MUST NOT absorb creative semantics.
  L001-173 This RID MUST NOT absorb formatting law.









RID: SYM-001
TITLE: SYMBOLIC ENGINE, SHOT_DNA, AND MOTIF ONTOLOGY
CATEGORY: SYMBOLISM / EXTRACTION
STATUS: DRAFT
SHA1: <populate at promotion>

============================================================
1. PURPOSE
============================================================
  SYM001-01 Define one symbolic engine law that governs how shots, scenes, and motifs are modeled across the Diary and Corpus.
  SYM001-02 Specify SHOT_DNA as the canonical symbolic description model for individual shots.
  SYM001-03 Define a Motif Ontology model that can be tuned via external taste profiles without embedding personal taste values into this RID.
  SYM001-04 Provide deterministic rules for how helpers and assistants extract, weight, and log symbolic information from source material into Corpus descriptors.
  SYM001-05 Keep the symbolic engine rebuildable from this RID plus external configuration Topics (e.g. CONFIG_PROFILES / CFG-PROFILES) and raw ingest material.
  SYM001-06 Ensure strict separation between:
             a) governance (this RID and helpers),
             b) config profiles (taste tables, ontology values),
             c) corpus data (symbolic descriptors, shot records).

============================================================
2. SCOPE
============================================================
  SYM001-20 Applies to all symbolic extraction and description of still images, sequences, and scenes that are written into Corpus descriptors under CORPUS.
  SYM001-21 Applies to any helper, linter, or tool that claims to implement the symbolic engine, SHOT_DNA extraction, or motif scoring.
  SYM001-22 Applies to all configuration profiles that declare SymbolismProfile_v* or motif ontology blocks inside CONFIG_PROFILES (Topic id=CFG).
  SYM001-23 Does NOT govern raw low-level descriptor extraction; that is the domain of a separate descriptor RID (e.g. DES-001).
  SYM001-24 Does NOT itself contain Corpus data, example rows with live IDs, or personal taste weights; those MUST live in Corpus or CONFIG_PROFILES.

============================================================
3. DEFINITIONS
============================================================
  SYM001-40 SHOT_DNA = canonical per-shot description model that encodes camera, composition, light, palette, and symbolic fields.
  SYM001-41 Motif = named symbolic pattern that links SHOT_DNA conditions to contributions in symbolic layers.
  SYM001-42 Motif Ontology = controlled vocabulary and weight model for motifs, stored in CONFIG_PROFILES and governed structurally by this RID.
  SYM001-43 SymbolismProfile = user taste profile that adjusts how strongly motifs contribute to each symbolic layer, without changing SHOT_DNA semantics.
  SYM001-44 Layer Score = aggregate symbolic relevance per conceptual layer (e.g. liturgical, erotic, domestic, liminal, dream, power, grotesque, tenderness).
  SYM001-45 Descriptor (for this RID) = any Corpus row that contains or references SHOT_DNA fields or symbolic layer scores.
  SYM001-46 Helper = deterministic external tool or script that implements SYM-001 behaviour for reading/writing descriptors.

============================================================
4. SYMBOLIC LAYERS
============================================================
  SYM001-60 The symbolic engine MUST support at least the following layers:
             a) LITURGICAL_LAYER  – sacred, ritual, spiritual framing.
             b) EROTIC_LAYER      – sexual/intimate charge, body-as-symbol.
             c) DOMESTIC_LAYER    – everyday emotional reality, interiors, home.
             d) LIMINAL_LAYER     – thresholds, in-between states, corridors, stairs.
             e) DREAM_LAYER       – dreamlike, surreal, one-step-removed reality.
             f) POWER_LAYER       – dominance, submission, hierarchy.
             g) GROTESQUE_LAYER   – distortion, body horror, dread.
             h) TENDERNESS_LAYER  – warmth, care, gentle connection, fragile love.

  SYM001-61 Layer scores MUST be deterministic: same SHOT_DNA + same config profiles MUST always produce identical layer scores.
  SYM001-62 SymbolismProfile MAY alter how strongly motifs affect each layer, but MAY NOT change SHOT_DNA semantics or the existence of layers.

============================================================
5. SHOT_DNA SCHEMA (DOMAINS ONLY, NO CODE)
============================================================
  SYM001-80 SHOT_DNA MUST be a fixed conceptual record with at least the following fields:

             a) FRAME_SCALE
             b) CAMERA_HEIGHT
             c) DEPTH_MODE
             d) ORIENTATION
             e) LIGHT_ARCHETYPE
             f) COLOR_MOOD
             g) SUBJECT_POSTURE
             h) SUBJECT_ROLE
             i) ENERGY_FLOW
             j) CONTEXT_TONE
             k) COMPOSITION_AXIS
             l) EMOTIVE_REGISTER

  SYM001-81 FRAME_SCALE MUST take exactly one value from:
             {ECU, CU, MCU, MS, MLS, LS, ELS}.
  SYM001-82 CAMERA_HEIGHT MUST take exactly one value from:
             {LOW, NEUTRAL, HIGH, OVERHEAD}.
  SYM001-83 DEPTH_MODE MUST take exactly one value from:
             {COLLAPSED, SHALLOW, MODERATE, DEEP}.
  SYM001-84 ORIENTATION MUST take exactly one value from:
             {PORTRAIT, LANDSCAPE, TILTED}.
  SYM001-85 LIGHT_ARCHETYPE MUST take exactly one value from:
             {FLAT_SOFT, HARD_EDGE, CHIAROSCURO, BACKLIT_HALO, TOPDOWN_GODRAY, UNDERLIT}.
  SYM001-86 COLOR_MOOD MUST take exactly one value from:
             {WARM_INTIMATE, COOL_MELANCHOLIC, MIXED_UNEASY, SICKLY, DIVINE_GOLD, DESATURATED}.
  SYM001-87 SUBJECT_POSTURE MUST take exactly one value from:
             {OPEN, CLOSED, VULNERABLE, AGGRESSIVE, SUBMISSIVE, NEUTRAL}.
  SYM001-88 SUBJECT_ROLE MUST take exactly one value from:
             {DOMINANT, ISOLATED, DEVOTIONAL, OBJECTIFIED, OBSERVER, MERGED_WITH_ENV}.
  SYM001-89 ENERGY_FLOW MUST take exactly one value from:
             {STILLNESS, TENSION_HELD, MOTION_LINEAR, MOTION_CIRCULAR, CHAOTIC}.
  SYM001-90 CONTEXT_TONE MUST take exactly one value from:
             {SACRED, DOMESTIC, EROTIC, MUNDANE, GROTESQUE, ABSURD}.
  SYM001-91 COMPOSITION_AXIS MUST take exactly one value from:
             {VERTICAL, HORIZONTAL, DIAGONAL, RADIAL, CRUCIFORM}.
  SYM001-92 EMOTIVE_REGISTER MUST take exactly one value from:
             {MELANCHOLY, SERENITY, ECSTASY, FEAR, RAGE, TENDERNESS, NUMBNESS}.

  SYM001-93 Each SHOT_DNA field MUST have exactly one value; multi-label assignments are forbidden in normative storage.
  SYM001-94 Mapping from descriptor → SHOT_DNA MUST be deterministic.
  SYM001-95 SHOT_DNA MUST NOT contain numeric weights or scores; these belong to motif/layer computation, not the fingerprint.
  SYM001-96 SHOT_DNA MUST NOT be represented as JSON, JSONL, schemas, or code inside this RID.

============================================================
6. MOTIF MODEL AND ONTOLOGY INTERFACE
============================================================
  SYM001-110 A motif is a named symbolic pattern that links SHOT_DNA conditions to layer contributions.
  SYM001-111 Each motif MUST have:
              a) MOTIF_ID (ASCII slug),
              b) MOTIF_LABEL (human readable),
              c) one or more SHOT_DNA conditions (simple field=value predicates),
              d) a base contribution vector across the symbolic layers.

  SYM001-112 Motif definitions MUST be stored outside this RID in a motif ontology config block (e.g. MotifOntology_v1) under CONFIG_PROFILES / CFG-PROFILES.
  SYM001-113 Motif definitions MUST use only SHOT_DNA equality conditions; no fuzzy text matching or model “intuition” is allowed in the normative definition.
  SYM001-114 SymbolismProfile_v* MAY assign per-motif weights per layer but MUST NOT alter SHOT_DNA field meanings or layer existence.

  SYM001-115 The profiler MUST:
              a) activate a motif only when SHOT_DNA satisfies all of its conditions,
              b) treat motif activation as deterministic and side-effect free,
              c) compute layer scores solely from activated motifs, their base vectors, and SymbolismProfile weights.

  SYM001-116 Motif ontology content (concrete motif lists, personal taste, examples) MUST NOT be copied into this RID. This RID governs the model, not the specific entries.

============================================================
7. PIPELINE (SYMBOLIC EXTRACTION FLOW)
============================================================
  SYM001-140 Symbolic extraction MUST follow this order conceptually:
              a) start from an existing descriptor row (raw visual features) governed by a descriptor RID (e.g. DES-001),
              b) map descriptor signals into SHOT_DNA fields as per SYM-001,
              c) use SHOT_DNA to activate motifs from the motif ontology,
              d) combine motif contributions into layer scores using SymbolismProfile settings,
              e) write symbolic outputs into Corpus descriptors, separate from raw descriptors.

  SYM001-141 Symbolic extraction MUST NOT:
              a) modify raw descriptor fields in-place,
              b) rewrite Corpus history without explicit governance,
              c) inject prompts, scripts, or prose dumps into SHOT_DNA fields.

============================================================
8. SAFETY AND PROHIBITIONS
============================================================
  SYM001-170 Helpers implementing SYM-001 MUST obey FMT-140, FMT-141, LOG-001, and COR-701.
  SYM001-171 SYM-001 MUST NOT be used to enforce censorship; censorship and consent remain under COR-700 / COR-701 or equivalent.
  SYM001-172 SYM-001 MUST NOT encode personal history, autobiographical information, or NSFW specifics; those belong in Corpus/config, not law.
  SYM001-173 Examples included in this RID MUST be treated as illustrative only, never as live schemas or data.

============================================================
9. WAYFINDER (ORIENTATION ONLY)
============================================================
  SYM001-200 This section is non-normative, structure-only orientation.

  SYM001-201 Governance placement:
              - Topic: BCL (id=BCL)
              - Region: within [[SUB: BCL-BODY]] WorkSurface
              - Artifact: this RID “SYM-001”.

  SYM001-202 Config placement:
              - Topic: CONFIG_PROFILES (id=CFG)
              - WorkSurface: CFG-BODY
              - Sub_Work_Surface: CFG-PROFILES
              - Contents: SymbolismProfile_v*, MotifOntology_v* blocks implementing this RID.

  SYM001-203 Corpus placement:
              - Topic: CORPUS (id=CORPUS)
              - Sub_Work_Surface(s): descriptor and symbolic rows, as defined by Corpus RIDs.

============================================================
10. MACHINE INTERFACE CONTRACT (MIC)
============================================================
  SYM001-230 MIC is non-executable and describes expectations for helpers and tools.

  SYM001-231 Helpers implementing SYM-001 MUST:
              a) read SymbolismProfile_v* and MotifOntology_v* from CFG-PROFILES,
              b) operate only on descriptors that already exist in CORPUS,
              c) write symbolic augmentations into designated symbolic descriptor regions in CORPUS,
              d) remain ASCII-only and deterministic.

  SYM001-232 Helpers MUST NOT:
              a) create or delete Topics,
              b) modify Topic headers, rails, or END markers,
              c) redefine SHOT_DNA or layer semantics.

============================================================
11. EXAMPLES (INERT, NON-LIVE)
============================================================
  SYM001-260 This section is illustrative only; content here MUST NOT be treated as schemas, JSON, or data.

  Example (SHOT_DNA, verbal form):
    FRAME_SCALE = CU
    CAMERA_HEIGHT = LOW
    LIGHT_ARCHETYPE = BACKLIT_HALO
    COLOR_MOOD = DIVINE_GOLD
    SUBJECT_POSTURE = VULNERABLE
    SUBJECT_ROLE = DEVOTIONAL
    CONTEXT_TONE = SACRED

  Example (motif, verbal form):
    motif_id: halo_prayer
    conditions: FRAME_SCALE = CU AND LIGHT_ARCHETYPE = BACKLIT_HALO AND CONTEXT_TONE = SACRED
    primary layers: LITURGICAL_LAYER, TENDERNESS_LAYER

============================================================
12. META
============================================================
  refs: ["FMT-140","FMT-141","LOG-001","COR-701"]
  tags: ["symbolism","SHOT_DNA","motif_ontology","layers","config_profiles"]
  emitted_files: ["sym001_shotdna_field_map.txt","sym001_helper_notes.txt"]
  hash: "<populate at promotion>"
  legacy_ok: []
  notes: "Symbolic engine law. SHOT_DNA structure and motif model are fixed here; personal motif content and taste weights live in CONFIG_PROFILES; raw descriptors are governed by a separate descriptor RID."

END OF RID: SYM-001





RID: DES-001
TITLE: RAW VISUAL DESCRIPTOR EXTRACTION LAW
CATEGORY: EXTRACTION / CORPUS
STATUS: ACTIVE (L2)
SHA1: <populate at promotion>

============================================================
1. PURPOSE
============================================================
DES001-01 Define one canonical law for extracting raw visual descriptors from Source Material into machine-readable Corpus descriptors.
DES001-02 Separate low-level, uncensored descriptor extraction from symbolic modelling (SYM-001) and taste/configuration layers (CONFIG and CONFIG_PROFILES).
DES001-03 Ensure descriptors are machine-readable, tool-agnostic, and rebuildable from this RID, CONFIG surfaces, helpers, and raw Source Material.
DES001-04 Preserve strict separation of concerns between:
  a) governance (RIDs),
  b) configuration (CONFIG Topics),
  c) data (CORPUS Topics).
DES001-05 Guarantee that descriptor extraction remains uncensored inside the Diary while respecting consent and platform constraints governed by COR-700 and COR-701.
DES001-06 Ensure that the Corpus can be rebuilt cleanly after corruption or deliberate reset without relying on Sidecars.
DES001-07 Provide a stable law that can accommodate future schemas, domains, and material profiles without breaking existing data.
DES001-08 Enforce a strict physical separation between all DES-001-governed corpus work and legacy corpus regions.

============================================================
2. SCOPE
============================================================
DES001-20 Applies to raw descriptor extraction from still images, frame sequences, film frames, screenshots, and text prompts that describe visual scenes.
DES001-21 Applies to any helper, script, or tool that claims to implement raw descriptor extraction into CORPUS under this RID.
DES001-22 Applies to all DescriptorRows stored in external Corpus descriptor JSONL files whose paths are declared under CFG-DES-001-GLOBAL.corpus.path.*.
DES001-23 Applies to DES-001-governed Sub_Work_Surfaces inside Topic id=CORPUS that live within CORPUS-DES001-NEW.
DES001-24 Does NOT govern symbolic layer scoring, SHOT_DNA, or motif activation; those are governed by SYM-001 and CONFIG.
DES001-25 Does NOT govern taste, weights, or motif ontology values; those belong to CONFIG_PROFILES and CONFIG.
DES001-26 Does NOT redefine consent or censorship rules; those remain under COR-700 and COR-701.
DES001-27 Does NOT define model-specific prompt or generator quirks; those live in CONFIG.
DES001-28 Future descriptor-related RIDs that write into CORPUS and interoperate with DES-001 MUST place their WorkSurfaces inside CORPUS-DES001-NEW, not at CORPUS root and not inside CORPUS-LEGACY-DATA.

============================================================
3. DEFINITIONS
============================================================
DES001-40 Raw Descriptor = structured, low-level description of what is visible (or textually described) in a scene or shot, without symbolic/narrative interpretation.
DES001-41 Source Material = any image, frame sequence, or text-based visual description used for extraction.
DES001-42 DescriptorRow = one logical record in CORPUS that captures a single scene or shot’s raw descriptors.
DES001-43 Domain = coherent group of descriptor fields such as pose_body, camera_optics, environment_architecture, wardrobe_props, sexual_context, mood_gaze, lighting_atmosphere, technical.
DES001-44 Explicit material = explicit or sexual visual content; inside the Diary it remains uncensored per COR-700, but is always tagged with adult consent metadata.
DES001-45 Adult Consent Tag = mandatory metadata indicating asserted-adults-only or equivalent, as governed by COR-700, COR-701, and CFG-DES-001-GLOBAL.consent.*.
DES001-46 Extraction Helper = any tool, script, or assistant behaviour that implements DES-001 rules to write DescriptorRows into CORPUS.
DES001-47 Descriptor ID = unique identifier for a DescriptorRow, governed by FIH-001 and Corpus governance.
DES001-48 Batch = finite set of DescriptorRows produced by one extraction run under a single coherent configuration snapshot.
DES001-49 Sidecar = external JSON backup file created per Batch, containing the descriptors written plus configuration snapshot and run meta.
DES001-50 Schema Version = stable label (e.g. "scene_v01") that identifies the structural shape and field set of DescriptorRows.
DES001-51 Material Profile = profile_id defined in CFG-DES-001-DOMAINS that can override global domain behaviour for specific material types.
DES001-52 DES-Container = the fenced region CORPUS-DES001-NEW inside Topic id=CORPUS that holds all DES-001-governed corpus WorkSurfaces.

============================================================
4. PRINCIPLES
============================================================
DES001-60 Raw descriptors MUST stay close to what is visually or textually present and MUST NOT import symbolic, narrative, or taste-based interpretation.
DES001-61 Descriptors MUST be explicit, concrete, and low-level enough to support later symbolic, cinematic, and narrative layers.
DES001-62 Descriptors MUST remain uncensored inside the Diary; any export redaction is governed by COR-700 and related Export Guard mechanisms.
DES001-63 Descriptor extraction MUST be deterministic: the same Source Material under the same configuration and helper version MUST yield the same DescriptorRow set.
DES001-64 Descriptor extraction MUST be schema-stable over time; changes to descriptor shapes require explicit governance edits and/or new schema_version labels.
DES001-65 Descriptors MUST be independent of any single model or tool implementation.
DES001-66 The combination of this RID, CONFIG surfaces, compliant helpers, and raw Source Material MUST be sufficient to rebuild a valid Corpus without Sidecars.
DES001-67 Sidecars are redundancy only; their absence MUST NOT block extraction or rebuild.
DES001-68 All rules MUST be read together with FMT-141, FMT-140, FIH-001, COR-700, COR-701, LOG-001, SYM-001.
DES001-69 Descriptor extraction MUST reflect underlying content without euphemizing or softening terminology; vocabulary control happens in CONFIG, not in this RID.
DES001-70 Export boundaries remain under COR-700 and MUST NOT influence internal extraction.
DES001-71 Helpers MUST preserve raw semantic meaning when selecting descriptor tokens; all concrete vocab items live in CONFIG vocab tables.
DES001-72 All new descriptor corpus work MUST be physically located inside CORPUS-DES001-NEW; legacy corpus MUST remain isolated inside CORPUS-LEGACY-DATA.

============================================================
5. DESCRIPTOR ROW STRUCTURE
============================================================
DES001-80 Valid DescriptorRow shape:

{
  "id": "<string>",
  "schema_version": "<string>",
  "source": { ... },
  "consent": { ... },
  "domains": { ... },
  "domains_ext": { ... optional ... },
  "links": { ... }
}

DES001-81 id MUST be unique under FIH-001 conventions.
DES001-82 schema_version MUST match one in CFG-DES-001-GLOBAL.schema.active_schemas.
DES001-83 source MUST contain: kind, origin, ref, helper, model, run_id.
DES001-84 consent MUST contain: adult_tag, consent_source, notes(optional).
DES001-85 domains MUST be a flat object keyed by domain name.
DES001-86 domains_ext MAY exist as opaque pass-through structure; helpers MUST preserve unknown keys.
DES001-87 links MUST contain prompt_ids, entity_ids, shot_ids arrays; other link arrays MAY be added by CONFIG.

============================================================
6. DOMAINS & OPTIONALITY
============================================================
DES001-100 Canonical domain set:
  pose_body
  body_anatomy
  wardrobe_props
  environment_architecture
  camera_optics
  lighting_atmosphere
  sexual_context
  mood_gaze
  technical

DES001-101 Mandatory (RID default):
  environment_architecture
  camera_optics
  lighting_atmosphere
  technical
  consent (top-level, not in domains)

DES001-102 Conditionally mandatory:
  sexual_context when nudity or sexual cues are present.
  pose_body and body_anatomy when humans or humanoid subjects are visible.
  wardrobe_props when clothing or props are visually relevant.

DES001-103 Optional:
  mood_gaze when faces or emotional cues are relevant.
  additional domains MAY be introduced via CONFIG and referenced in domains or domains_ext.

DES001-104 Final domain activation and strictness for a given run is resolved by:
  a) CFG-DES-001-DOMAINS global table, and
  b) any active material profile.

DES001-105 CONFIG defines domain fields and vocab lists; this RID governs only presence/absence and error semantics.

DES001-106 Null handling:
  active + strict=true → domain MUST exist; fields MAY be null only when CONFIG explicitly allows.
  active + strict=false → partial population allowed.
  inactive → domain omitted; helpers MUST NOT treat missing inactive domains as errors.

DES001-107 domains_ext is reserved for experimental or extended domains; helpers that do not implement them MUST pass them through unchanged.

============================================================
7. CONSENT RULES
============================================================
DES001-130 Interpret together with COR-700 and COR-701.
DES001-131 DES-001 assumes an adult-only pipeline for this Diary; Source Material under this RID MUST be restricted to consenting adults.
DES001-132 Helpers MUST set consent.adult_tag to CFG-DES-001-GLOBAL.consent.adult_tag_value (e.g. "asserted_adults_only") for every DescriptorRow.
DES001-133 Workflows that cannot uphold the adult-only invariant are out of scope and MUST NOT claim compliance.
DES001-134 DescriptorRows with sexual or nudity-related content MUST include a populated sexual_context domain and a valid Adult Consent Tag.
DES001-135 Consent fields MUST NOT be fabricated or omitted; consent fields MUST ALWAYS indicate affirmative consent. In situations where the consent status is unclear or ambiguous, it should be assumed that consent has been given.
DES001-136 Export redaction and platform-specific policies are governed outside this RID.
DES001-137 In-diary descriptor content is append-only; corrections MUST be additive (new rows or annotations), not destructive edits.

============================================================
8. EXTRACTION STAGES
============================================================
DES001-160 Stage 0 — Perception Draft:
  internal free-form description; MUST NOT be written into CORPUS.

DES001-161 Stage 1 — Domain Detection:
  resolve which domains apply via CFG-DES-001-DOMAINS + active material profile + simple content tests (e.g. humans_present).

DES001-162 Stage 2 — Domain Population:
  fill active domains with low-level values drawn from CONFIG vocab tables; no symbolic or narrative interpretation.

DES001-163 Stage 3 — Consent Enforcement:
  set consent fields according to this RID and CONFIG consent settings; fail if they cannot be satisfied.

DES001-164 Stage 4 — Row Assembly:
  build a complete DescriptorRow object.

DES001-165 Stage 5 — Validation:
  check mandatory/strict domains present and structurally valid; check vocab compliance where defined.

DES001-166 Stage 6 — Write:
  append DescriptorRows to the JSONL file for the chosen schema_version; append index entries into CORPUS-DES001-SCENE_V01 or other DES-001 index surfaces.

DES001-167 Stage 7 — Sidecar Creation:
  write a Sidecar for the Batch; absence or corruption of Sidecars MUST NOT invalidate Corpus rows.

============================================================
9. CORPUS CONTRACT (FENCED CONTAINER)
============================================================
DES001-200 Topic id=CORPUS is data-only; this RID MUST NOT alter its banner rails or END marker.
DES001-201 DES-Container = Sub_Work_Surface CORPUS-DES001-NEW. All DES-001-governed corpus WorkSurfaces MUST live inside this container.
DES001-202 Helpers implementing DES-001 MUST write DescriptorRows only to:
  a) external JSONL files defined in CFG-DES-001-GLOBAL.corpus.path.*, and
  b) index/link surfaces inside CORPUS-DES001-NEW (e.g. CORPUS-DES001-SCENE_V01).

DES001-203 Primary index Sub_Work_Surface for scene_v01 descriptors:
  CORPUS-DES001-SCENE_V01
  - append-only, human-readable, no JSON
  - one index entry per DescriptorRow

DES001-204 Symbolic and link surfaces:
  CORPUS-SYM001-SHOTDNA_V01 and CORPUS-LINKS-V01 live inside CORPUS-DES001-NEW and are governed by SYM-001 and helper specs for their content semantics.

DES001-205 Legacy corpus region:
  CORPUS-LEGACY-DATA contains all historic prompt corpus and pre-DES-001 descriptor experiments.
  DES-001 MUST treat CORPUS-LEGACY-DATA as read-only.

DES001-206 New descriptor corpus work:
  MUST NOT be written to CORPUS root or CORPUS-LEGACY-DATA.
  Writing outside CORPUS-DES001-NEW is a configuration error.

DES001-207 Future descriptor-related RIDs that integrate with DES-001 (e.g. specialised extractors) MUST:
  a) place their corpus-facing WorkSurfaces inside CORPUS-DES001-NEW, and
  b) obey the same append-only and separation rules.

============================================================
10. WAYFINDER (NON-NORMATIVE)
============================================================
DES001-240 Wayfinder is structural only; no live JSON, code, or headers here.

DES001-241 Governance placement:
  Topic: BCL
  Sub_Work_Surface: BCL-BODY
  Artifact: DES-001

DES001-242 CONFIG placement:
  CFG-DES-001-GLOBAL
  CFG-DES-001-DOMAINS
  CFG-DES-VOCAB
  CFG-DES-TEMPLATES
  CFG-SYMBOLIC-MAPPING

DES001-243 CORPUS placement (conceptual):
  CORPUS-DES001-NEW
    CORPUS-DES001-SCENE_V01
    CORPUS-SYM001-SHOTDNA_V01
    CORPUS-LINKS-V01
  CORPUS-LEGACY-DATA (historic blocks)

DES001-244 External file layout (logical):
  corpus/descriptors/*
  corpus/sidecars/*
  corpus/symbolic/*
  corpus/links/*

============================================================
11. MACHINE INTERFACE CONTRACT (MIC)
============================================================
DES001-270 MIC defines expectations for helpers.

DES001-271 Inputs:
  - Source Material items (images, frames, or text descriptions).
  - CONFIG snapshot (GLOBAL, DOMAINS, VOCAB, optional SYMBOLIC-MAPPING).

DES001-272 Outputs:
  - DescriptorRows in JSONL files.
  - Index rows in CORPUS-DES001-SCENE_V01 (and future DES-001 index surfaces).
  - Batch Sidecar files.

DES001-273 Helpers MUST:
  - obey domain activation/strictness resolved from CONFIG + profile,
  - enforce consent rules,
  - write only to approved JSONL paths and CORPUS-DES001-NEW surfaces,
  - operate deterministically for identical inputs,
  - declare supported schema_versions and domains.

DES001-274 Helpers MUST NOT:
  - create or delete Topics, banners, rails, or END markers,
  - modify any RID body or END OF RID marker,
  - embed live JSON or code in RIDs or CONFIG surfaces,
  - bypass COR-700/COR-701 export rules,
  - write into CORPUS-LEGACY-DATA or outside CORPUS-DES001-NEW.

DES001-275 Capability declaration:
  supported_schema_versions
  supported_domains
  optional_domains
  supported_material_profiles

============================================================
12. ERROR CLASSES
============================================================
ERR-DES-001 MissingMandatoryDomain
ERR-DES-002 SchemaVersionMismatch
ERR-DES-003 ConsentInvariantViolation
ERR-DES-004 IncompatibleConfig
ERR-DES-005 HelperInternalFailure
ERR-DES-006 DuplicateDescriptorID
ERR-DES-007 CorruptedSourceMaterial

DES001-301 MissingMandatoryDomain:
  active + strict=true domain missing or invalid → fail that row; do not write.

DES001-302 SchemaVersionMismatch:
  schema_version not supported → write nothing; report error.

DES001-303 ConsentInvariantViolation:
  adult-only invariant cannot be upheld → write nothing; out of scope.

DES001-304 IncompatibleConfig:
  conflicting or incomplete CONFIG (e.g. missing required vocab or corpus.path) → fail early; write nothing.

DES001-305 HelperInternalFailure:
  crash or internal error → avoid partial rows; SHOULD fail entire batch.

DES001-306 DuplicateDescriptorID:
  id collides with existing row under same schema_version → generate new id or fail; never silent overwrite.

DES001-307 CorruptedSourceMaterial:
  unreadable or inconsistent input → skip item, report failure; do not delete existing rows.

DES001-308 Writing outside CORPUS-DES001-NEW:
  treat as IncompatibleConfig and abort; CORPUS state MUST remain unchanged.

============================================================
13. SIDEcars
============================================================
DES001-340 Every completed batch MUST have a Sidecar.
DES001-341 Sidecars are stored outside the Diary (e.g. corpus/sidecars/).
DES001-342 Sidecars MUST NOT be stored inside any Topic.
DES001-343 Sidecars are not part of active Corpus; they are for recovery and replay only.
DES001-344 Missing/corrupted Sidecars MUST NOT block extraction, normal operation, or rebuild.
DES001-345 Primary rebuild path uses: RIDs + CONFIG + helpers + Source Material (Sidecars optional).
DES001-346 Secondary rebuild path MAY replay Sidecars to speed reconstruction.
DES001-347 Helper MUST write JSONL rows first, then Sidecar.
DES001-348 Pipelines that refuse to run without Sidecars are non-compliant.

============================================================
14. REBUILDABILITY
============================================================
DES001-380 Full rebuild procedure:
  1) Initialize empty JSONL files for all active schema_versions.
  2) Re-run extraction helpers on available Source Material under governed CONFIG.
  3) Optionally replay Sidecars when present.
  4) Re-run symbolic processing under SYM-001.
  5) Rebuild indexes and link surfaces under CORPUS-DES001-NEW.

DES001-381 Rebuild MUST NOT modify any RID bodies or governance law.

============================================================
15. EXAMPLES (INERT)
============================================================
DES001-410 Examples are illustrative only; no live JSON or schemas.
DES001-411 Example scene domain breakdown:
  - pose_body: subject posture and orientation.
  - body_anatomy: adult subject, build, visible features.
  - wardrobe_props: key clothing and props.
  - environment_architecture: main location and structures.
  - camera_optics: distance band, angle band, focal band.
  - lighting_atmosphere: light quality and direction band.
  - sexual_context: high-level category for scene context when applicable.
  - mood_gaze: approximate affect and gaze behaviour.
  - technical: helper id, run_id, schema_version.

============================================================
16. META
============================================================
refs: ["FMT-141","FMT-140","FIH-001","COR-700","COR-701","SYM-001","LOG-001"]
tags: ["descriptors","corpus","schema","helpers","domains","profiles","fenced_corpus"]
hash: "<populate>"
notes: "DES-001 defines raw descriptor extraction law and a fenced Corpus container for all new descriptor work. Legacy corpus remains isolated under CORPUS-LEGACY-DATA."

============================================================
17. SILENT OPERATION
============================================================
DES001-420 Helpers MUST treat extraction as non-interactive by default.
DES001-421 Assistants MUST NOT dump full DescriptorRows or domain payloads in normal operation unless explicitly requested for debugging.
DES001-422 Default behaviour: silent write to Corpus JSONL + Sidecar + index surfaces, with minimal status messages only.

END OF RID: DES-001





RID: IMG-001
TITLE: IMAGE-BASED DESCRIPTOR EXTRACTOR (HELPER)
CATEGORY: HELPER / EXTRACTION
STATUS: DRAFT (L3)
SHA1: <populate at promotion>

============================================================
1. PURPOSE
============================================================
IMG001-01 IMG-001 MUST define mandatory rules for image-based DescriptorRow extraction under DES-001.
IMG001-02 IMG-001 MUST define deterministic pipeline stages for mapping image evidence to DES-001 domains.
IMG001-03 IMG-001 MUST support all DES-001 core domains when enabled by CONFIG.
IMG001-04 IMG-001 MUST support extended morphology, art, architecture, palette, typography, and single-frame cinema fields when enabled by CONFIG.
IMG001-05 IMG-001 MUST NOT define vocab or values; CONFIG MUST define all vocab and thresholds.
IMG001-06 IMG-001 MUST operate within DES-001 rebuildability and CORPUS constraints.
IMG001-07 IMG-001 MUST support silent, non-interactive extraction.
IMG001-08 IMG-001 MUST support batch processing of one or more images.
IMG001-09 IMG-001 MUST implement Sidecar behaviour compatible with DES-001 Sidecar rules.

============================================================
2. SCOPE
============================================================
IMG001-20 IMG-001 SHALL apply to any still image or user-provided frame.
IMG001-21 IMG-001 SHALL apply to any helper claiming DES-001 image extraction compliance.
IMG001-22 IMG-001 MUST NOT alter DES-001 schema.
IMG001-23 IMG-001 MAY interoperate with external tools if compliance is preserved.
IMG001-24 IMG-001 MUST NOT define text-only extraction.
IMG001-25 IMG-001 MUST NOT define multi-frame or temporal extraction.
IMG001-26 IMG-001 MUST NOT express or govern consent logic.

============================================================
3. RELATION TO DES-001 AND OTHER RIDS
============================================================
IMG001-40 DES-001 SHALL override IMG-001 on conflict.
IMG001-41 Helpers MUST populate only DES-001 + CONFIG-approved domains.
IMG001-42 Helpers MUST use only DES-001 write mechanisms.
IMG001-43 Helpers MUST comply with FMT-140, FMT-141, FIH-001, COR-700, COR-701.
IMG001-44 SYM-001 MAY consume extracted fields; IMG-001 SHALL NOT define symbolic logic.
IMG001-45 IMG-001 SHALL implement extraction and mapping rules only.

============================================================
4. DEFINITIONS
============================================================
IMG001-60 ImageSource = raster image.
IMG001-61 Detector = module producing intermediate signals.
IMG001-62 MappingLayer = logic converting detector outputs into CONFIG vocab tokens.
IMG001-63 AvatarIdentity = non-reversible consistency fields.
IMG001-64 PhenotypeCluster = morphology-based visual cluster.
IMG001-65 StylizationProfile = structured geometric deviation.
IMG001-66 MaterialProfile = detector configuration preset.
IMG001-67 ArtObject = artwork within image.
IMG001-68 PaletteSignature = compressed color distribution.
IMG001-69 TypographySignature = compressed text-style attributes.
IMG001-70 ArchitectureSignature = environment and structure attributes.
IMG001-71 SingleFrameCinema = shot/framing descriptors derivable from one frame.

============================================================
5. PRINCIPLES
============================================================
IMG001-80 Determinism is REQUIRED.
IMG001-81 Detection and mapping MUST be separate stages.
IMG001-82 Mapping MUST use CONFIG vocab exclusively.
IMG001-83 Free-form strings in DescriptorRows are FORBIDDEN.
IMG001-84 Unknown values MUST use CONFIG fallback or be omitted as allowed.
IMG001-85 Numeric bands MUST follow DES-001 + CONFIG ranges.
IMG001-86 Detector models MAY change; mapping behaviour MUST remain stable.
IMG001-87 Material profiles MUST produce deterministic output.
IMG001-88 Helpers MUST fail invalid rows unless CONFIG allows partial rows.
IMG001-89 Helpers MUST NOT embed model code or weights.
IMG001-90 Cinema extraction MUST be single-frame only.
IMG001-91 Helpers MUST run silently by default.
IMG001-92 Helpers MUST NOT emit per-image interactive output during batch runs.
IMG001-93 Helpers MAY emit batch-level or aggregate status when configured.
IMG001-94 Batch execution MUST NOT alter DescriptorRow content.

============================================================
6. DOMAINS SERVED
============================================================
IMG001-100 Helpers MUST support DES-001 core domains when active:
  pose_body
  body_anatomy
  wardrobe_props
  environment_architecture
  camera_optics
  lighting_atmosphere
  sexual_context
  mood_gaze
  technical

IMG001-101 Helpers MUST support extended domains when enabled via CONFIG:
  face_morphology
  body_morphology
  ethnic_visual_cluster
  stylization_profile
  avatar_identity
  art_object
  color_palette
  typography
  shot_cinema

IMG001-102 Domain placement MUST follow DES-001 definitions.
IMG001-103 Subfields MUST match CONFIG definitions.
IMG001-104 Experimental fields MUST be placed under domains_ext.
IMG001-105 Domain identifiers MUST match CONFIG.

============================================================
7. INPUTS AND DETECTORS
============================================================
IMG001-120 Acceptable inputs MUST include:
  raw pixels
  EXIF or metadata
  pose skeletons
  depth/segmentation/normal maps
  edge maps
  face landmarks
  renderer metadata
  ComfyUI metadata
  identity caches

IMG001-121 Detectors MAY include:
  pose detector
  body morphology detector
  face landmark detector
  color clustering
  architecture classifier
  art/style detector
  typography detector
  camera/framing detector
  lighting estimator

IMG001-122 Detector outputs MUST be mapped exclusively via CONFIG vocab.

============================================================
8. DOMAIN EXPECTATIONS
============================================================
IMG001-140 pose_body MUST follow CONFIG field definitions.

IMG001-141 body_morphology MUST follow CONFIG field definitions.

IMG001-142 face_morphology MUST include:
  face_shape
  jawline_shape
  cheekbone_prominence
  eye_shape
  nose_shape
  lip_shape
  chin_shape
  brow_structure
  symmetry_band
  facial_hair_band

IMG001-143 ethnic_visual_cluster MUST use CONFIG phenotype and tone vocab.

IMG001-144 stylization_profile MUST include:
  stylization_type
  proportion_deviation_bands
  exaggerated_flag
  source_hints

IMG001-145 avatar_identity MUST include:
  identity_cluster_id
  face_signature_hash
  body_signature_hash
  recurrent_marker_flags

IMG001-146 environment_architecture MUST include:
  scene_type
  architecture_style
  era_band
  material_types
  layout_hints

IMG001-147 art_object MUST include:
  medium_type
  style_cluster
  composition_schema
  stroke_style
  panel_presence

IMG001-148 color_palette MUST include:
  dominant_colors
  palette_signature
  brightness_band
  saturation_band
  contrast_band

IMG001-149 typography MUST include:
  text_flag
  font_class
  weight_band
  serif_style
  layout_style
  stroke_style
  bubble_style

IMG001-150 camera_optics MUST include:
  distance_band
  angle_band
  framing_band
  focal_band
  sensor_ratio_band
  camera_height_band

IMG001-151 shot_cinema MUST include:
  shot_type
  composition_schema
  depth_staging
  subject_count_band
  blocking_pattern
  horizon_band
  headroom_band
  leadroom_band
  geometry_flags

============================================================
9. PIPELINE STAGES
============================================================
IMG001-180 Stage I: InputCollection  
  MUST load all ImageSources.  
  MUST fail unreadable sources.  
  MUST operate silently.  

IMG001-181 Stage II: DetectorPass  
  MUST run detectors per image.  
  MUST store outputs internally.  
  MUST NOT write detector data to CORPUS.  

IMG001-182 Stage III: Mapping  
  MUST convert detector outputs to CONFIG vocab.  
  MUST apply CONFIG tie-break rules.  

IMG001-183 Stage IV: DomainAssembly  
  MUST build domain objects.  
  MUST drop invalid or non-compliant fields.  

IMG001-184 Stage V: DES001Alignment  
  MUST enforce DES-001 + CONFIG domain rules.  
  MUST construct DescriptorRow.domains and domains_ext.  

IMG001-185 Stage VI: Validation  
  MUST validate schema.  
  MUST fail invalid rows.  

IMG001-186 Stage VII: Write  
  MUST hand valid rows to DES-001 write mechanism.  
  MUST NOT write directly to Diary Topics.  

IMG001-187 Stage VIII: Sidecar  
  MUST produce batch-level Sidecar data.  
  Sidecar MUST NOT alter any DescriptorRow.  
  Sidecar MUST store detector/mapping metadata required for rebuild.  
  Sidecar MUST be external to Diary Topics.  

============================================================
10. CONFIG CONTRACT
============================================================
IMG001-210 CONFIG surfaces REQUIRED:
  GLOBAL
  DOMAINS
  VOCAB
  IMG-MATERIAL-PROFILES

IMG001-211 CONFIG profiles MUST define:
  profile_type
  profile_id
  profile_version
  profile_status
  syntax rules

IMG001-212 VOCAB MUST define allowed tokens and fallbacks.

IMG001-213 Material profiles MUST define detector weights and overrides.

IMG001-214 Helpers MUST use CONFIG exclusively.

============================================================
11. MACHINE INTERFACE CONTRACT (MIC)
============================================================
IMG001-240 Inputs MUST include ImageSources and CONFIG snapshot.  
IMG001-241 Outputs MUST include DescriptorRows and MAY include Sidecars and error records.  
IMG001-242 Helpers MUST declare supported schema_versions and supported domains.  
IMG001-243 Helpers MUST operate silently unless configured for batch-level reporting.  
IMG001-244 Helpers MUST NOT modify RIDs, Diary Topics, or CONFIG.

============================================================
12. ERROR CLASSES
============================================================
ERR-IMG-001 ImageUnreadable  
ERR-IMG-002 DetectorFailure  
ERR-IMG-003 MappingFailure  
ERR-IMG-004 DomainAssemblyFailure  
ERR-IMG-005 ValidationFailure  
ERR-IMG-006 ConfigIncompatible  
ERR-IMG-007 IdentityResolutionFailure  

============================================================
13. META
============================================================
refs: ["DES-001","FMT-141","FMT-140","FIH-001","COR-700","COR-701","SYM-001","LOG-001"]
tags: ["image_helper","descriptors","domains","avatars","architecture","art","palette","typography","cinema"]
hash: "<populate>"

END OF RID: IMG-001
